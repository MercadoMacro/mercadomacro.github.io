<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercado Macro - Insights e Relatórios Exclusivos</title>
    <meta name="description" content="Acesse estudos aprofundados, relatórios semanais e análises financeiras exclusivas do Mercado Macro. Mantenha-se à frente no mercado.">
    <meta name="keywords" content="estudos financeiros, relatórios de mercado, análise macroeconômica, educação financeira, insights de investimento, renda fixa, ações, commodities, mercado de carbono, fintech">
    <meta property="og:title" content="Mercado Macro - Insights e Relatórios Exclusivos">
    <meta property="og:description" content="Acompanhe as tendências e aprofunde seus conhecimentos com nossos relatórios e estudos financeiros de alta qualidade.">
    <meta property="og:image" content="https://mercadomacro.github.io/assets/thumbnail-reports.png">
    <meta property="og:url" content="https://mercadomacro.github.io/relatorios.html">
    <meta name="theme-color" content="#0d1117">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css"> <style>
        /* Variáveis de tema herdadas do styles.css */
        :root {
            --report-card-bg-opacity: 0.15;
            --report-card-border-opacity: 0.2;
            --report-card-hover-scale: 1.02;
            --report-card-hover-shadow: 0 15px 40px rgba(0,0,0,0.4);
            --modal-bg-dark: #010409; /* Mais escuro para o modal */
            --modal-text-color: #e6edf3;
            --modal-light-bg: #f5f5f5;
            --modal-light-text: #333;
        }

        body.light-mode {
            --report-card-bg-opacity: 0.05;
            --report-card-border-opacity: 0.1;
            --report-card-hover-shadow: 0 10px 30px rgba(0,0,0,0.2);
            --modal-bg-dark: #f8f9fa;
            --modal-text-color: #212529;
            --modal-light-bg: #ffffff;
            --modal-light-text: #000;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            padding: 100px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px; /* Altura mínima para o hero */
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -20%;
            left: -20%;
            width: 140%;
            height: 140%;
            background: radial-gradient(circle at center, rgba(var(--primary-color-val-rgb), 0.15) 0%, transparent 70%);
            animation: rotate-gradient 30s linear infinite;
            z-index: 0;
            will-change: transform;
        }

        @keyframes rotate-gradient {
            0% { transform: rotate(0deg) scale(0.9); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(0.9); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            transform: translateY(0);
            opacity: 1;
            animation: fadeInScale 1s ease-out forwards;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .hero-content h1 {
            font-size: 4em;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 25px;
            background: linear-gradient(120deg, var(--primary-light), var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px rgba(0,209,128,0.2);
        }

        .hero-content p {
            font-size: 1.3em;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.7;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* Search and Filter Area */
        .search-filter-area {
            position: relative;
            z-index: 2; /* Para sobrepor o hero-section e dar mais destaque */
            max-width: 1100px;
            margin: -80px auto 60px auto; /* Para sobrepor bem o hero-section */
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 15px 45px var(--shadow-color-medium);
            display: flex;
            flex-direction: column;
            gap: 25px;
            border: 1px solid var(--border-color);
        }

        .search-bar-container {
            position: relative;
        }

        #report-search-input {
            width: 100%;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: rgba(var(--card-bg-val), 0.3);
            color: var(--text-color);
            font-size: 17px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
            -webkit-appearance: none; /* Remove estilos padrão de input em iOS */
        }

        #report-search-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        #report-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: var(--darker-bg);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-val-rgb), 0.25);
        }

        .autocomplete-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            max-height: 250px;
            overflow-y: auto;
            z-index: 100;
            display: none; /* Controlado via JS */
        }

        .autocomplete-item {
            padding: 12px 20px;
            cursor: pointer;
            color: var(--text-color);
            font-size: 15px;
            border-bottom: 1px solid rgba(var(--card-bg-val), 0.1);
            transition: background-color 0.2s ease;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover, .autocomplete-item.active {
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            color: var(--primary-color);
        }

        .filter-tags-area {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .filter-tag-btn {
            background-color: rgba(var(--card-bg-val), 0.7);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transform: translateZ(0); /* Força aceleração de hardware */
        }

        .filter-tag-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(var(--primary-color-val-rgb), 0.2);
            border-radius: 50%;
            transition: width 0.3s ease, height 0.3s ease, top 0.3s ease, left 0.3s ease;
            transform: translate(-50%, -50%);
            z-index: 0;
        }

        .filter-tag-btn:hover::before {
            width: 200%;
            height: 200%;
        }

        .filter-tag-btn:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        .filter-tag-btn.active {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border-color: var(--primary-color);
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(var(--primary-color-val-rgb), 0.4);
            transform: translateY(-2px);
        }

        .filter-tag-btn.active::before {
            width: 0; /* Desativa o efeito hover quando ativo */
            height: 0;
        }
        
        .filter-tag-btn span {
            position: relative; /* Para manter o texto acima do pseudo-elemento */
            z-index: 1;
        }

        /* Featured Report Section */
        .featured-report-section {
            max-width: 1200px;
            margin: 80px auto;
            padding: 0 20px;
            opacity: 0; /* Controlado por Scroll Reveal */
            transform: translateY(20px); /* Controlado por Scroll Reveal */
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .featured-report-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .featured-report-section h2 {
            font-size: 2.2em;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .featured-report-section h2::after {
            content: '';
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .featured-report-card {
            display: flex;
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow-color-medium);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .featured-report-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .featured-report-image {
            flex: 1;
            min-width: 40%;
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .featured-report-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .featured-report-card:hover .featured-report-image img {
            transform: scale(1.08);
        }

        .featured-report-image i {
            position: absolute;
            font-size: 8em;
            color: var(--primary-color);
            opacity: 0.1;
        }

        .featured-report-content {
            flex: 1.5;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .featured-report-content .report-type {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .featured-report-content h3 {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .featured-report-content .report-date {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .featured-report-content p {
            font-size: 1.1em;
            color: var(--text-color);
            line-height: 1.7;
            margin-bottom: 30px;
        }

        .featured-report-content .read-more-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            align-self: flex-start;
        }

        .featured-report-content .read-more-btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(var(--primary-color-val-rgb), 0.3);
        }

        .featured-report-content .report-card-tags {
             margin-top: 20px;
        }

        /* Report Grid */
        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto 50px auto;
            padding: 0 20px;
            min-height: 300px;
        }
        
        .report-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.8s ease-out, transform 0.8s ease-out;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(var(--primary-color-val-rgb), var(--report-card-border-opacity));
            opacity: 0; /* Controlado por Scroll Reveal */
            transform: translateY(20px); /* Controlado por Scroll Reveal */
        }
        .report-card.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .report-card:hover {
            transform: translateY(-8px) scale(var(--report-card-hover-scale));
            box-shadow: var(--report-card-hover-shadow);
        }

        .report-card-image {
            width: 100%;
            height: 220px;
            background-color: rgba(var(--primary-color-val-rgb), var(--report-card-bg-opacity));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 3.5em;
            overflow: hidden;
            position: relative;
        }
        
        .report-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .report-card:hover .report-card-image img {
            transform: scale(1.05);
        }
        
        .report-card-image i {
            position: absolute;
            opacity: 0.2;
            font-size: 4em;
        }

        .report-card-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .report-card-content h3 {
            font-size: 1.4em;
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .report-card-content .report-date {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .report-card-content p {
            font-size: 1em;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 20px;
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .report-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .report-card-tag {
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            color: var(--primary-color);
            font-size: 0.78em;
            padding: 6px 12px;
            border-radius: 18px;
            font-weight: 500;
            white-space: nowrap;
        }

        .report-card-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid rgba(var(--card-bg-val), 0.1);
        }

        .report-card .read-more-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .report-card .read-more-btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .view-summary-btn {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .view-summary-btn:hover {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            transform: translateY(-2px);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.2s ease;
            padding: 5px;
        }
        .favorite-btn:hover {
            color: var(--primary-light);
            transform: scale(1.1);
        }
        .favorite-btn.favorited {
            color: #FFC107; /* Cor de estrela/favorito */
            transform: scale(1.1);
        }

        .load-more-container {
            text-align: center;
            margin: 50px auto 80px auto;
            max-width: 1200px;
            padding: 0 20px;
        }

        #load-more-btn {
            background-color: var(--dark-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        #load-more-btn:hover {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(var(--primary-color-val-rgb), 0.5);
        }

        #load-more-btn:disabled {
            background-color: rgba(var(--card-bg-val), 0.5);
            border-color: rgba(var(--text-secondary-rgb), 0.5);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .no-results {
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.2em;
            padding: 80px 20px;
            grid-column: 1 / -1;
        }

        /* Suggestions Section */
        .suggestions-section {
            max-width: 1200px;
            margin: 80px auto;
            padding: 0 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .suggestions-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .suggestions-section h2 {
            font-size: 2.2em;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .suggestions-section h2::after {
            content: '';
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .suggested-reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        .suggested-reports-container .report-card { /* Reutiliza o estilo de card */
            box-shadow: 0 3px 15px rgba(0,0,0,0.15); /* Sombra mais suave */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .suggested-reports-container .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        .suggested-reports-container .report-card-image { height: 180px; }
        .suggested-reports-container .report-card-content h3 { font-size: 1.2em; }
        .suggested-reports-container .report-card-content p { font-size: 0.9em; -webkit-line-clamp: 2; }
        .suggested-reports-container .report-card .read-more-btn { font-size: 13px; padding: 8px 15px; }
        .suggested-reports-container .view-summary-btn { font-size: 12px; padding: 8px 12px; }

        /* Modal de Visualização Rápida */
        .quick-view-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        }

        .quick-view-modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .quick-view-modal-content {
            background-color: var(--modal-bg-dark);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px; /* Maior para melhor leitura */
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            border: 1px solid var(--border-color);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: var(--modal-text-color);
        }

        .quick-view-modal-overlay.active .quick-view-modal-content {
            transform: scale(1);
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(var(--card-bg-val), 0.3);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover {
            background-color: var(--error-color);
            color: white;
            transform: rotate(90deg) scale(1.1);
        }

        .modal-report-image {
            width: 100%;
            height: 250px;
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 5em;
            position: relative;
        }

        .modal-report-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-report-image i {
            position: absolute;
            opacity: 0.15;
            font-size: 6em;
        }

        .modal-report-content h3 {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .modal-report-content .report-date {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .modal-report-content p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        
        .modal-reading-options {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(var(--card-bg-val), 0.1);
        }
        .modal-reading-options button {
            background: none;
            border: 1px solid var(--text-secondary);
            color: var(--text-secondary);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }
        .modal-reading-options button:hover {
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .modal-reading-options button.active {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border-color: var(--primary-color);
        }

        /* Reading Mode specific styles */
        .quick-view-modal-content.reading-mode {
            background-color: var(--modal-light-bg);
            color: var(--modal-light-text);
            border-color: rgba(0,0,0,0.1); /* Soft border for light mode reading */
        }
        body.light-mode .quick-view-modal-content.reading-mode {
            background-color: var(--modal-light-bg);
            color: var(--modal-light-text);
            border-color: rgba(0,0,0,0.1);
        }
        .quick-view-modal-content.reading-mode h3,
        .quick-view-modal-content.reading-mode .report-date,
        .quick-view-modal-content.reading-mode .report-card-tag {
            color: var(--modal-light-text); /* Garante que o texto fique legível no modo leitura */
        }
        .quick-view-modal-content.reading-mode .report-card-tag {
            background-color: rgba(var(--primary-color-val-rgb), 0.15); /* Mantém destaque da tag */
        }
        .quick-view-modal-content.reading-mode .modal-report-image i {
            color: var(--modal-light-text);
            opacity: 0.08;
        }

        .modal-reading-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 5px;
            background-color: var(--primary-color);
            width: 0%;
            border-radius: 0 0 5px 5px;
            transition: width 0.1s linear;
        }

        .modal-report-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid rgba(var(--card-bg-val), 0.15);
            padding-top: 20px;
        }

        .modal-report-actions .read-more-btn {
            font-size: 16px;
            padding: 12px 25px;
        }

        /* Light Mode Adjustments */
        body.light-mode .hero-section::before {
            background: radial-gradient(circle at center, rgba(var(--primary-color-val-rgb), 0.2) 0%, transparent 70%);
        }

        body.light-mode .hero-content h1 {
            text-shadow: 0 3px 10px rgba(0,123,255,0.1);
        }

        body.light-mode .search-filter-area {
            background-color: var(--card-bg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: var(--border-color);
        }

        body.light-mode #report-search-input {
            background-color: rgba(0,0,0,0.03);
            border-color: var(--border-color);
            color: var(--text-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        body.light-mode #report-search-input:focus {
            background-color: #fff;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-val-rgb), 0.15);
        }

        body.light-mode .autocomplete-results {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        body.light-mode .autocomplete-item:hover, body.light-mode .autocomplete-item.active {
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            color: var(--primary-color);
        }

        body.light-mode .filter-tag-btn {
            background-color: rgba(0,0,0,0.05);
            color: var(--text-secondary);
            border-color: var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        body.light-mode .filter-tag-btn::before {
            background: rgba(var(--primary-color-val-rgb), 0.1);
        }

        body.light-mode .filter-tag-btn:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.light-mode .filter-tag-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(var(--primary-color-val-rgb), 0.2);
        }

        body.light-mode .featured-report-section h2 {
            color: var(--primary-color);
        }
        body.light-mode .featured-report-section h2::after {
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
        }

        body.light-mode .featured-report-card {
            background: var(--card-bg);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--border-color);
        }

        body.light-mode .featured-report-card:hover {
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        body.light-mode .featured-report-image {
            background-color: rgba(var(--primary-color-val-rgb), 0.08);
            color: var(--primary-color);
        }

        body.light-mode .featured-report-content h3 {
            color: var(--primary-color);
        }

        body.light-mode .featured-report-content .read-more-btn {
            background-color: var(--primary-color);
            color: white;
        }

        body.light-mode .featured-report-content .read-more-btn:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 3px 10px rgba(var(--primary-color-val-rgb), 0.2);
        }

        body.light-mode .report-card {
            background: var(--card-bg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: rgba(var(--primary-color-val-rgb), 0.1);
        }

        body.light-mode .report-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        body.light-mode .report-card-image {
            background-color: rgba(var(--primary-color-val-rgb), 0.05);
            color: var(--primary-color);
        }

        body.light-mode .report-card-image i {
            opacity: 0.1;
        }

        body.light-mode .report-card-content h3 {
            color: var(--primary-color);
        }

        body.light-mode .report-card-tag {
            background-color: rgba(var(--primary-color-val-rgb), 0.08);
            color: var(--primary-color);
        }

        body.light-mode .report-card-actions {
             border-top-color: rgba(0,0,0,0.05);
        }

        body.light-mode .report-card .read-more-btn {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 1px 5px rgba(var(--primary-color-val-rgb), 0.15);
        }

        body.light-mode .report-card .read-more-btn:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 2px 8px rgba(var(--primary-color-val-rgb), 0.2);
        }

        body.light-mode .view-summary-btn {
            background: none;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        body.light-mode .view-summary-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        body.light-mode .favorite-btn.favorited {
            color: #FFC107;
        }


        body.light-mode #load-more-btn {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }

        body.light-mode #load-more-btn:hover {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 6px 20px rgba(var(--primary-color-val-rgb), 0.3);
        }
        
        body.light-mode .quick-view-modal-content {
            background-color: var(--dark-bg);
            border-color: var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.25);
        }

        body.light-mode .modal-close-btn {
            background: rgba(0,0,0,0.1);
            border-color: var(--border-color);
            color: var(--text-secondary);
        }

        body.light-mode .modal-close-btn:hover {
            background-color: var(--error-color);
            color: white;
        }

        body.light-mode .modal-report-image {
            background-color: rgba(var(--primary-color-val-rgb), 0.08);
            color: var(--primary-color);
        }

        body.light-mode .modal-report-image i {
            opacity: 0.1;
        }

        body.light-mode .modal-report-actions {
            border-top-color: rgba(0,0,0,0.08);
        }

        body.light-mode .modal-reading-options button:hover {
            background-color: rgba(var(--primary-color-val-rgb), 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        body.light-mode .modal-reading-options button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Responsividade Avançada */
        @media (max-width: 1024px) {
            .hero-content h1 { font-size: 3.2em; }
            .hero-content p { font-size: 1.1em; }
            .search-filter-area { max-width: 900px; margin-top: -60px; padding: 25px; }
            .featured-report-section { margin: 60px auto; }
            .featured-report-content h3 { font-size: 1.8em; }
            .featured-report-content p { font-size: 1em; }
            .report-grid { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
            .report-card-image { height: 200px; }
        }

        @media (max-width: 768px) {
            body { zoom: 0.9; }
            .hero-section { padding: 80px 15px; min-height: 350px; }
            .hero-content h1 { font-size: 2.8em; }
            .hero-content p { font-size: 1em; margin-bottom: 30px; }
            .search-filter-area { margin-top: -50px; padding: 20px; border-radius: 12px; gap: 20px; }
            #report-search-input { padding: 12px 18px; font-size: 16px; }
            .filter-tags-area { justify-content: flex-start; }
            .filter-tag-btn { padding: 8px 15px; font-size: 14px; }
            .featured-report-section { margin: 40px auto; }
            .featured-report-card { flex-direction: column; }
            .featured-report-image { min-width: 100%; height: 250px; }
            .featured-report-content { padding: 25px; text-align: center; }
            .featured-report-content .report-type { text-align: center; }
            .featured-report-content h3 { font-size: 1.6em; text-align: center; }
            .featured-report-content .report-date { text-align: center; }
            .featured-report-content p { text-align: left; }
            .featured-report-content .read-more-btn { align-self: center; }
            .report-grid { grid-template-columns: 1fr; gap: 25px; padding: 0 15px; }
            .report-card-image { height: 220px; }
            .report-card-content h3 { font-size: 1.3em; }
            .report-card-content p { font-size: 0.95em; }
            .report-card .read-more-btn { padding: 9px 18px; font-size: 14px; }
            .view-summary-btn { padding: 9px 14px; font-size: 13px; }
            .favorite-btn { font-size: 1em; }
            #load-more-btn { padding: 12px 25px; font-size: 16px; }
            .quick-view-modal-content { width: 95%; padding: 25px; }
            .modal-report-image { height: 200px; margin-bottom: 20px; }
            .modal-report-content h3 { font-size: 1.8em; }
            .modal-report-content p { font-size: 1em; margin-bottom: 25px; }
            .modal-report-actions { flex-direction: column; gap: 10px; align-items: center; }
            .modal-report-actions .read-more-btn { width: 100%; text-align: center; }
            .suggestions-section { margin: 40px auto; }
            .suggested-reports-container { grid-template-columns: 1fr; gap: 20px; }
            .suggested-reports-container .report-card-image { height: 160px; }
            .suggested-reports-container .report-card-content h3 { font-size: 1.1em; }
            .suggested-reports-container .report-card-content p { font-size: 0.85em; }
        }

        @media (max-width: 480px) {
            .hero-section { padding: 60px 10px; min-height: 300px; }
            .hero-content h1 { font-size: 2.2em; }
            .hero-content p { font-size: 0.9em; margin-bottom: 20px; }
            .search-filter-area { margin-top: -40px; padding: 15px; gap: 15px; }
            #report-search-input { padding: 10px 15px; font-size: 15px; }
            .filter-tag-btn { padding: 7px 14px; font-size: 13px; }
            .featured-report-section { margin: 30px auto; }
            .featured-report-image { height: 200px; }
            .featured-report-content { padding: 20px; }
            .featured-report-content h3 { font-size: 1.4em; }
            .featured-report-content p { font-size: 0.9em; margin-bottom: 20px; }
            .featured-report-content .read-more-btn { padding: 10px 20px; font-size: 15px; }
            .report-card-image { height: 180px; }
            .report-card-content { padding: 15px; }
            .report-card-content h3 { font-size: 1.2em; }
            .report-card-content p { font-size: 0.9em; }
            .report-card .read-more-btn { padding: 8px 15px; font-size: 13px; }
            .view-summary-btn { padding: 8px 12px; font-size: 12px; }
            #load-more-btn { padding: 10px 20px; font-size: 15px; }
            .modal-report-image { height: 160px; }
            .modal-report-content h3 { font-size: 1.5em; }
            .modal-report-content p { font-size: 0.95em; }
        }
    </style>
</head>
<body>
    <div id="scroll-progress-bar"></div>

    <header class="header">
        <div class="logo-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <div class="page-title-header">Mercado Macro</div>
                    <div class="logo-divider"></div>
                </a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <div class="hero-content">
                <h1>Insights Financeiros para Suas Decisões</h1>
                <p>Aprofunde seu conhecimento com nossos relatórios exclusivos, análises semanais e estudos de educação financeira, criados para te dar uma vantagem decisiva no mercado.</p>
            </div>
        </section>

        <section class="search-filter-area">
            <div class="search-bar-container">
                <input type="text" id="report-search-input" placeholder="Buscar por título, resumo ou palavra-chave...">
                <div class="autocomplete-results" id="autocomplete-results"></div>
            </div>
            <div class="filter-tags-area" id="filter-tags-container">
                </div>
        </section>

        <section class="featured-report-section" id="featured-report-section">
            <h2>Relatório em Destaque</h2>
            <div id="featured-report-card-container">
                <p class="no-results" id="loading-featured-message">Carregando relatório em destaque...</p>
            </div>
        </section>

        <section class="suggestions-section" id="suggestions-section" style="display: none;">
            <h2>Sugestões para Você</h2>
            <div class="suggested-reports-container" id="suggested-reports-container">
                <p class="no-results">Carregando sugestões...</p>
            </div>
        </section>

        <section class="report-grid" id="report-list">
            <p class="no-results" id="loading-reports-message">Carregando estudos e relatórios...</p>
        </section>

        <div class="load-more-container">
            <button id="load-more-btn" disabled>
                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                Carregar Mais Relatórios
            </button>
        </div>
    </main>

    <button class="theme-toggle floating-btn" id="theme-toggle" aria-label="Alternar tema claro/escuro"><i class="fas fa-moon"></i></button>
    <a href="index.html" class="floating-btn" style="left: 20px; bottom: 80px;" aria-label="Voltar para o Painel Principal">
        <i class="fas fa-arrow-left"></i>
    </a>
    <a href="contato.html" class="floating-btn" style="left: 20px; bottom: 140px;" aria-label="Entre em Contato">
        <i class="fas fa-envelope"></i>
    </a>
    
    <div class="legal-links" style="margin: 20px auto 40px auto; text-align: center; font-size: 13px; opacity: 0.65;">
      <a href="termo/sobre.html" style="margin: 0 15px; color: var(--text-color); text-decoration: none;">Sobre</a>
      <a href="termo/politica.html" style="margin: 0 15px; color: var(--text-color); text-decoration: none;">Política de Privacidade</a>
      <a href="termo/termos.html" style="margin: 0 15px; color: var(--text-color); text-decoration: none;">Termos de Uso</a>
    </div>
    <div class="footer" id="footer">Fonte: Dados atualizados em <span id="footer-datetime">Carregando...</span> • By Anderson Danilo </div>

    <div class="quick-view-modal-overlay" id="quick-view-modal-overlay">
        <div class="quick-view-modal-content" id="quick-view-modal-content">
            <button class="modal-close-btn" id="modal-close-btn" aria-label="Fechar visualização rápida"><i class="fas fa-times"></i></button>
            <div class="modal-reading-progress-bar" id="modal-reading-progress-bar"></div>
            
            <div class="modal-report-image" id="modal-report-image"></div>
            
            <div class="modal-reading-options">
                <button id="reading-mode-toggle-btn" aria-label="Alternar modo leitura"><i class="fas fa-book-open"></i> Modo Leitura</button>
                <button id="modal-favorite-btn" aria-label="Adicionar/Remover dos favoritos"><i class="fas fa-heart"></i> Favoritar</button>
            </div>

            <div class="modal-report-content" id="modal-report-content">
                </div>
            <div class="modal-report-actions">
                <a href="#" target="_blank" rel="noopener noreferrer" class="read-more-btn" id="modal-download-btn">
                    <i class="fas fa-download"></i> Baixar Relatório Completo
                </a>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // FUNÇÕES AUXILIARES GERAIS (DEFINIDAS GLOBALMENTE PARA ACESSIBILIDADE)
        // =============================================
        function debounce(func, wait, immediate) {
            let timeout;
            return function() {
                const context = this, args = arguments;
                const later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                const callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '';
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return date.toLocaleDateString('pt-BR', options);
            } catch (e) {
                console.error("Erro ao formatar data:", dateString, e);
                return '';
            }
        }

        // Função para alternar o tema
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLightMode = document.body.classList.contains('light-mode');
            localStorage.setItem('themePreference', isLightMode ? 'light' : 'dark');
            const themeIcon = document.querySelector('#theme-toggle i');
            if (themeIcon) {
                themeIcon.classList.toggle('fa-moon', !isLightMode);
                themeIcon.classList.toggle('fa-sun', isLightMode);
            }
        }

        function updateFooterDateTime() {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
            const footerDatetimeEl = document.getElementById('footer-datetime');
            if (footerDatetimeEl) {
                footerDatetimeEl.textContent = formattedDate;
            }
        }
        
        const debouncedUpdateScrollProgressBar = debounce(function() {
            const progressBar = document.getElementById('scroll-progress-bar');
            if (!progressBar) return;
            const docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrollPercent = (window.scrollY / docHeight) * 100;
            progressBar.style.width = `${scrollPercent}%`;
        }, 10);

        function playSound(file) {
            const audio = new Audio(`assets/sounds/${file}.mp3`); // Supondo uma pasta 'assets/sounds'
            audio.volume = 0.3; // Volume mais baixo para sons de UI
            audio.play().catch(e => console.warn("Erro ao tocar som:", e));
        }

        // =============================================
        // CONFIGURAÇÕES GLOBAIS E ESTADO DO APP
        // =============================================
        const REPORTS_PER_PAGE = 8; // Quantidade de relatórios a carregar por vez na grade principal
        const FAVORITES_KEY = 'mercadoMacroReportsFavorites_v1';
        const READ_HISTORY_KEY = 'mercadoMacroReportsReadHistory_v1';
        const MAX_SUGGESTIONS = 3;

        let allReports = [];
        let uniqueTags = new Set();
        let appState = {
            searchTerm: '',
            activeTags: new Set(),
            currentPage: 0,
            loading: false,
            featuredReportId: null, // O ID do relatório em destaque, se houver
            activeModalReport: null // O relatório atualmente visível no modal
        };

        // =============================================
        // FUNÇÕES DE CARREGAMENTO DE DADOS
        // =============================================
        async function fetchReportsData() {
            try {
                const response = await fetch('data/relatorios.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                // Ordena por data mais recente
                allReports = data.sort((a, b) => new Date(b.date) - new Date(a.date));

                // Define o relatório em destaque (o mais recente por padrão)
                if (allReports.length > 0) {
                    appState.featuredReportId = allReports[0].id;
                }

                populateFilterTags();
                applyFiltersAndRender();
                renderSuggestedReports(); // Renderiza sugestões após carregar tudo
            } catch (error) {
                console.error('Erro ao carregar relatórios:', error);
                const reportListContainer = document.getElementById('report-list');
                if (reportListContainer) {
                    reportListContainer.innerHTML = '<p class="no-results">Erro ao carregar os relatórios. Por favor, tente novamente mais tarde.</p>';
                }
                const featuredReportContainer = document.getElementById('featured-report-card-container');
                 if (featuredReportContainer) {
                    featuredReportContainer.innerHTML = '<p class="no-results">Erro ao carregar o relatório em destaque.</p>';
                }
                const suggestedReportsContainer = document.getElementById('suggested-reports-container');
                if (suggestedReportsContainer) {
                    suggestedReportsContainer.innerHTML = '<p class="no-results">Erro ao carregar sugestões.</p>';
                }
            } finally {
                const loadingMessage = document.getElementById('loading-reports-message');
                if (loadingMessage) loadingMessage.style.display = 'none';
                 const loadingFeaturedMessage = document.getElementById('loading-featured-message');
                if (loadingFeaturedMessage) loadingFeaturedMessage.style.display = 'none';
            }
        }

        // =============================================
        // FUNÇÕES DE RENDERIZAÇÃO DA UI
        // =============================================

        function getIconForReport(report) {
            const tags = report.tags ? report.tags.map(t => t.toLowerCase()) : [];
            if (tags.includes('macroeconomia') || tags.includes('mercado')) return 'fas fa-chart-area';
            if (tags.includes('investimentos') || tags.includes('acoes')) return 'fas fa-chart-line';
            if (tags.includes('educacao') || tags.includes('guia')) return 'fas fa-book-reader';
            if (tags.includes('tecnologia') || tags.includes('fintech')) return 'fas fa-robot';
            if (tags.includes('semanal') || tags.includes('panorama')) return 'fas fa-calendar-alt';
            if (tags.includes('agronegocio') || tags.includes('commodities')) return 'fas fa-seedling';
            if (tags.includes('inflacao') || tags.includes('juros')) return 'fas fa-dollar-sign';
            if (tags.includes('sustentabilidade') || tags.includes('ESG')) return 'fas fa-leaf';
            return 'fas fa-file-alt'; // Ícone padrão
        }

        function renderReportCard(report, isFeatured = false, isSuggested = false) {
            const cardElement = document.createElement('div');
            cardElement.classList.add(isFeatured ? 'featured-report-card' : (isSuggested ? 'report-card' : 'report-card'));
            cardElement.dataset.id = report.id;

            const iconClass = getIconForReport(report);
            const imageHtml = report.image ? `<img src="${report.image}" alt="${report.title}" loading="lazy">` : `<i class="${iconClass}"></i>`;

            const tagsHtml = report.tags ? report.tags.map(tag => `<span class="report-card-tag">${tag}</span>`).join('') : '';

            const isFavorited = getFavorites().includes(report.id);
            const favoriteBtnClass = isFavorited ? 'favorited' : '';
            const favoriteIconClass = isFavorited ? 'fas fa-heart' : 'far fa-heart';

            let actionsHtml = '';
            if (isFeatured) {
                actionsHtml = `
                    <a href="${report.link}" target="_blank" rel="noopener noreferrer" class="read-more-btn">
                        <i class="fas fa-download"></i> Baixar Relatório Completo
                    </a>
                    <button class="favorite-btn ${favoriteBtnClass}" data-report-id="${report.id}" aria-label="${isFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                        <i class="${favoriteIconClass}"></i>
                    </button>
                `;
            } else {
                actionsHtml = `
                    <button class="view-summary-btn" data-report-id="${report.id}">
                        <i class="fas fa-eye"></i> Ver Resumo
                    </button>
                    <a href="${report.link}" target="_blank" rel="noopener noreferrer" class="read-more-btn">
                        <i class="fas fa-download"></i> Baixar
                    </a>
                    <button class="favorite-btn ${favoriteBtnClass}" data-report-id="${report.id}" aria-label="${isFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                        <i class="${favoriteIconClass}"></i>
                    </button>
                `;
            }

            cardElement.innerHTML = `
                <div class="${isFeatured ? 'featured-report-image' : 'report-card-image'}">
                    ${imageHtml}
                </div>
                <div class="${isFeatured ? 'featured-report-content' : 'report-card-content'}">
                    ${isFeatured ? `<div class="report-type">Relatório Destaque</div>` : ''}
                    <h3>${report.title}</h3>
                    <span class="report-date">${formatDate(report.date)}</span>
                    <p>${report.summary}</p>
                    <div class="report-card-tags">
                        ${tagsHtml}
                    </div>
                    <div class="report-card-actions">
                        ${actionsHtml}
                    </div>
                </div>
            `;

            if (!isFeatured) {
                const viewSummaryBtn = cardElement.querySelector('.view-summary-btn');
                if (viewSummaryBtn) {
                    viewSummaryBtn.addEventListener('click', () => {
                        playSound('click');
                        openQuickViewModal(report.id);
                    });
                }
            }

            const favoriteBtn = cardElement.querySelector('.favorite-btn');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', (event) => toggleFavorite(event, report.id));
            }

            return cardElement;
        }

        function renderReportGrid(reports) {
            const reportListContainer = document.getElementById('report-list');
            if (!reportListContainer) return;

            reportListContainer.innerHTML = '';

            if (reports.length === 0) {
                reportListContainer.innerHTML = '<p class="no-results">Nenhum estudo ou relatório encontrado para sua busca e filtros.</p>';
                return;
            }

            reports.forEach((report, index) => {
                const card = renderReportCard(report);
                reportListContainer.appendChild(card);
                scrollRevealObserver.observe(card);
            });

            updateLoadMoreButton();
        }

        function renderFeaturedReport() {
            const featuredReportContainer = document.getElementById('featured-report-card-container');
            if (!featuredReportContainer) return;

            featuredReportContainer.innerHTML = '';
            const featuredReport = allReports.find(r => r.id === appState.featuredReportId);

            if (featuredReport) {
                const card = renderReportCard(featuredReport, true);
                featuredReportContainer.appendChild(card);
                scrollRevealObserver.observe(document.getElementById('featured-report-section'));
            } else {
                featuredReportContainer.innerHTML = '<p class="no-results">Nenhum relatório em destaque disponível.</p>';
            }
        }
        
        function populateFilterTags() {
            const filterTagsContainer = document.getElementById('filter-tags-container');
            if (!filterTagsContainer) return;

            uniqueTags = new Set();
            allReports.forEach(report => {
                if (report.tags) {
                    report.tags.forEach(tag => uniqueTags.add(tag.toLowerCase()));
                }
            });

            filterTagsContainer.innerHTML = '';

            const allButton = document.createElement('button');
            allButton.classList.add('filter-tag-btn');
            allButton.innerHTML = `<span>Todos</span>`;
            allButton.dataset.tag = 'all';
            allButton.addEventListener('click', () => {
                playSound('pop');
                appState.activeTags.clear();
                filterTagsContainer.querySelectorAll('.filter-tag-btn').forEach(btn => btn.classList.remove('active'));
                allButton.classList.add('active');
                applyFiltersAndRender();
            });
            filterTagsContainer.appendChild(allButton);
            allButton.classList.add('active');

            Array.from(uniqueTags).sort().forEach(tag => {
                const button = document.createElement('button');
                button.classList.add('filter-tag-btn');
                button.innerHTML = `<span>${tag.charAt(0).toUpperCase() + tag.slice(1)}</span>`;
                button.dataset.tag = tag;
                button.addEventListener('click', () => {
                    playSound('pop');
                    if (appState.activeTags.has(tag)) {
                        appState.activeTags.delete(tag);
                        button.classList.remove('active');
                    } else {
                        appState.activeTags.add(tag);
                        button.classList.add('active');
                        allButton.classList.remove('active');
                    }
                    if (appState.activeTags.size === 0) {
                        allButton.classList.add('active');
                    }
                    applyFiltersAndRender();
                });
                filterTagsContainer.appendChild(button);
            });
        }

        function updateLoadMoreButton() {
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (!loadMoreBtn) return;

            const totalFiltered = getFilteredReports(true).length;
            const currentlyDisplayed = appState.currentPage * REPORTS_PER_PAGE;

            if (currentlyDisplayed < totalFiltered) {
                loadMoreBtn.style.display = 'inline-flex';
                loadMoreBtn.disabled = appState.loading;
                loadMoreBtn.querySelector('i').style.display = appState.loading ? 'inline-block' : 'none';
                loadMoreBtn.lastChild.textContent = appState.loading ? 'Carregando...' : 'Carregar Mais Relatórios';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }

        function renderSuggestedReports() {
            const suggestionsSection = document.getElementById('suggestions-section');
            const suggestedReportsContainer = document.getElementById('suggested-reports-container');
            if (!suggestionsSection || !suggestedReportsContainer) return;

            suggestedReportsContainer.innerHTML = '';

            const favorites = getFavorites();
            const readHistory = getReadHistory();

            let potentialSuggestions = [];

            // 1. Relatórios favoritos (exclui o destaque e já lidos)
            const favReports = allReports.filter(report => 
                favorites.includes(report.id) && 
                report.id !== appState.featuredReportId &&
                !readHistory.includes(report.id)
            );
            potentialSuggestions.push(...favReports);

            // 2. Relatórios com tags semelhantes aos últimos lidos/favoritados (exemplo simplificado: top 3 tags mais interagidas)
            const allInteractedReports = new Set([...favorites, ...readHistory]);
            const interactedTags = {};
            allInteractedReports.forEach(id => {
                const report = allReports.find(r => r.id === id);
                if (report && report.tags) {
                    report.tags.forEach(tag => {
                        interactedTags[tag] = (interactedTags[tag] || 0) + 1;
                    });
                }
            });
            const sortedInteractedTags = Object.entries(interactedTags).sort(([,a],[,b]) => b - a).map(([tag]) => tag);
            
            const relevantTags = sortedInteractedTags.slice(0, 3);
            
            const taggedSuggestions = allReports.filter(report => 
                !allInteractedReports.has(report.id) &&
                report.id !== appState.featuredReportId &&
                report.tags && report.tags.some(tag => relevantTags.includes(tag.toLowerCase()))
            );
            potentialSuggestions.push(...taggedSuggestions);

            // 3. Relatórios mais recentes (que não sejam favoritos, lidos ou o destaque)
            const recentSuggestions = allReports.filter(report => 
                !favorites.includes(report.id) &&
                !readHistory.includes(report.id) &&
                report.id !== appState.featuredReportId &&
                !potentialSuggestions.some(s => s.id === report.id)
            ).slice(0, MAX_SUGGESTIONS * 2);

            potentialSuggestions.push(...recentSuggestions);


            const finalSuggestions = [];
            const seenIds = new Set();
            for (const report of potentialSuggestions) {
                if (!seenIds.has(report.id)) {
                    finalSuggestions.push(report);
                    seenIds.add(report.id);
                }
                if (finalSuggestions.length >= MAX_SUGGESTIONS) break;
            }

            if (finalSuggestions.length > 0) {
                suggestionsSection.style.display = 'block';
                finalSuggestions.forEach(report => {
                    const card = renderReportCard(report, false, true);
                    suggestedReportsContainer.appendChild(card);
                    scrollRevealObserver.observe(card);
                });
                scrollRevealObserver.observe(suggestionsSection);
            } else {
                suggestionsSection.style.display = 'none';
            }
        }


        // =============================================
        // LÓGICA DE FILTRAGEM E PESQUISA
        // =============================================
        function getFilteredReports(getAll = false) {
            let filtered = allReports.filter(report => {
                if (report.id === appState.featuredReportId) {
                    return false;
                }

                const searchTermLower = appState.searchTerm.toLowerCase();
                const matchesSearch = searchTermLower === '' ||
                    report.title.toLowerCase().includes(searchTermLower) ||
                    report.summary.toLowerCase().includes(searchTermLower) ||
                    (report.tags && report.tags.some(tag => tag.toLowerCase().includes(searchTermLower)));

                const matchesTags = appState.activeTags.size === 0 ||
                    (report.tags && Array.from(appState.activeTags).every(filterTag =>
                        report.tags.some(reportTag => reportTag.toLowerCase().includes(filterTag))
                    ));

                return matchesSearch && matchesTags;
            });

            if (getAll) {
                return filtered;
            }

            const startIndex = 0;
            const endIndex = appState.currentPage * REPORTS_PER_PAGE;
            return filtered.slice(startIndex, endIndex);
        }

        function applyFiltersAndRender() {
            appState.currentPage = 1;
            const reportsToDisplay = getFilteredReports();
            renderReportGrid(reportsToDisplay);
            renderFeaturedReport();
            renderSuggestedReports();
        }

        // =============================================
        // AUTOCOMPLETE DA BARRA DE PESQUISA
        // =============================================
        function showAutocompleteResults(query) {
            const autocompleteResults = document.getElementById('autocomplete-results');
            if (!autocompleteResults) return;

            autocompleteResults.innerHTML = '';
            if (query.length < 2) {
                autocompleteResults.style.display = 'none';
                return;
            }

            const lowerQuery = query.toLowerCase();
            const matchingTitles = new Set();
            const matchingTags = new Set();

            allReports.forEach(report => {
                if (report.title.toLowerCase().includes(lowerQuery)) {
                    matchingTitles.add(report.title);
                }
                if (report.tags) {
                    report.tags.forEach(tag => {
                        if (tag.toLowerCase().includes(lowerQuery)) {
                            matchingTags.add(tag);
                        }
                    });
                }
            });

            const results = [...Array.from(matchingTitles).sort(), ...Array.from(matchingTags).sort()];

            if (results.length === 0) {
                autocompleteResults.style.display = 'none';
                return;
            }

            results.slice(0, 5).forEach(item => {
                const div = document.createElement('div');
                div.classList.add('autocomplete-item');
                div.textContent = item;
                div.addEventListener('click', () => {
                    document.getElementById('report-search-input').value = item;
                    appState.searchTerm = item.toLowerCase();
                    autocompleteResults.style.display = 'none';
                    applyFiltersAndRender();
                    playSound('select');
                });
                autocompleteResults.appendChild(div);
            });

            autocompleteResults.style.display = 'block';
        }

        function hideAutocompleteResults() {
            setTimeout(() => {
                const autocompleteResults = document.getElementById('autocomplete-results');
                if (autocompleteResults) autocompleteResults.style.display = 'none';
            }, 100);
        }

        // =============================================
        // MODAL DE VISUALIZAÇÃO RÁPIDA (COM MODO LEITURA E FAVORITOS)
        // =============================================
        function openQuickViewModal(reportId) {
            const modalOverlay = document.getElementById('quick-view-modal-overlay');
            const modalImageContainer = document.getElementById('modal-report-image');
            const modalContent = document.getElementById('modal-report-content');
            const modalDownloadBtn = document.getElementById('modal-download-btn');
            const modalFavoriteBtn = document.getElementById('modal-favorite-btn');
            const modalProgressBar = document.getElementById('modal-reading-progress-bar');
            const readingModeToggleBtn = document.getElementById('reading-mode-toggle-btn');
            
            appState.activeModalReport = allReports.find(r => r.id === reportId);

            if (!appState.activeModalReport || !modalOverlay || !modalImageContainer || !modalContent || !modalDownloadBtn || !modalFavoriteBtn || !modalProgressBar || !readingModeToggleBtn) {
                console.error('Erro: Elementos do modal ou relatório não encontrados.', {reportId, report: appState.activeModalReport});
                return;
            }

            addToReadHistory(reportId);

            modalImageContainer.innerHTML = '';
            modalContent.innerHTML = '';
            modalProgressBar.style.width = '0%';

            const report = appState.activeModalReport;
            const iconClass = getIconForReport(report);
            if (report.image) {
                const img = document.createElement('img');
                img.src = report.image;
                img.alt = report.title;
                modalImageContainer.appendChild(img);
            } else {
                const icon = document.createElement('i');
                icon.className = iconClass;
                modalImageContainer.appendChild(icon);
            }

            modalContent.innerHTML = `
                <h3>${report.title}</h3>
                <span class="report-date">${formatDate(report.date)}</span>
                <p>${report.summary}</p>
                <div class="report-card-tags">
                    ${report.tags ? report.tags.map(tag => `<span class="report-card-tag">${tag}</span>`).join('') : ''}
                </div>
            `;
            modalDownloadBtn.href = report.link;

            const isFavorited = getFavorites().includes(report.id);
            modalFavoriteBtn.classList.toggle('favorited', isFavorited);
            modalFavoriteBtn.querySelector('i').className = isFavorited ? 'fas fa-heart' : 'far fa-heart';
            modalFavoriteBtn.setAttribute('aria-label', isFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos');

            const newModalFavoriteBtn = modalFavoriteBtn.cloneNode(true);
            modalFavoriteBtn.parentNode.replaceChild(newModalFavoriteBtn, modalFavoriteBtn);
            appState.currentModalFavoriteBtn = newModalFavoriteBtn;

            appState.currentModalFavoriteBtn.addEventListener('click', () => {
                toggleFavorite(null, report.id);
                const currentIsFavorited = getFavorites().includes(report.id);
                appState.currentModalFavoriteBtn.classList.toggle('favorited', currentIsFavorited);
                appState.currentModalFavoriteBtn.querySelector('i').className = currentIsFavorited ? 'fas fa-heart' : 'far fa-heart';
                appState.currentModalFavoriteBtn.setAttribute('aria-label', currentIsFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos');
            });

            modalOverlay.classList.remove('reading-mode');
            readingModeToggleBtn.classList.remove('active');
            const newReadingModeToggleBtn = readingModeToggleBtn.cloneNode(true);
            readingModeToggleBtn.parentNode.replaceChild(newReadingModeToggleBtn, readingModeToggleBtn);
            appState.currentReadingModeToggleBtn = newReadingModeToggleBtn;

            appState.currentReadingModeToggleBtn.addEventListener('click', toggleReadingMode);
            
            modalContent.onscroll = throttle(() => {
                const contentHeight = modalContent.scrollHeight - modalContent.clientHeight;
                if (contentHeight > 0) {
                    const scrollPercent = (modalContent.scrollTop / contentHeight) * 100;
                    modalProgressBar.style.width = `${scrollPercent}%`;
                }
            }, 50);


            modalOverlay.classList.add('active');
            document.body.classList.add('body-modal-open');
            modalContent.scrollTop = 0;
        }

        function closeQuickViewModal() {
            const modalOverlay = document.getElementById('quick-view-modal-overlay');
            if (modalOverlay) {
                modalOverlay.classList.remove('active');
                document.body.classList.remove('body-modal-open');
                appState.activeModalReport = null;
                modalOverlay.classList.remove('reading-mode');
                if (appState.currentReadingModeToggleBtn) {
                     appState.currentReadingModeToggleBtn.classList.remove('active');
                }
                playSound('close');
            }
        }

        function toggleReadingMode() {
            const modalContentEl = document.getElementById('quick-view-modal-content');
            const readingModeToggleBtn = document.getElementById('reading-mode-toggle-btn');
            
            if (modalContentEl && readingModeToggleBtn) {
                const isActive = modalContentEl.classList.toggle('reading-mode');
                readingModeToggleBtn.classList.toggle('active', isActive);
                playSound('toggle');
            }
        }

        // =============================================
        // FAVORITOS E HISTÓRICO DE LEITURA
        // =============================================
        function getFavorites() {
            try {
                return JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
            } catch (e) {
                console.error("Erro ao carregar favoritos:", e);
                return [];
            }
        }

        function saveFavorites(favorites) {
            try {
                localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            } catch (e) {
                console.error("Erro ao salvar favoritos:", e);
            }
        }

        function toggleFavorite(event, reportId) {
            if (event) event.stopPropagation();
            
            let favorites = getFavorites();
            const index = favorites.indexOf(reportId);

            if (index === -1) {
                favorites.push(reportId);
                playSound('favorite');
            } else {
                favorites.splice(index, 1);
                playSound('unfavorite');
            }
            saveFavorites(favorites);

            document.querySelectorAll(`.favorite-btn[data-report-id="${reportId}"]`).forEach(btn => {
                const isFavorited = favorites.includes(reportId);
                btn.classList.toggle('favorited', isFavorited);
                btn.querySelector('i').className = isFavorited ? 'fas fa-heart' : 'far fa-heart';
                btn.setAttribute('aria-label', isFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos');
            });
            renderSuggestedReports();
        }

        function getReadHistory() {
            try {
                return JSON.parse(localStorage.getItem(READ_HISTORY_KEY)) || [];
            } catch (e) {
                console.error("Erro ao carregar histórico de leitura:", e);
                return [];
            }
        }

        function addToReadHistory(reportId) {
            let history = getReadHistory();
            history = history.filter(id => id !== reportId);
            history.unshift(reportId);
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            try {
                localStorage.setItem(READ_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error("Erro ao salvar histórico de leitura:", e);
            }
            renderSuggestedReports();
        }

        // =============================================
        // SCROLL REVEAL (Animação de entrada ao rolar)
        // =============================================
        const scrollRevealOptions = {
            root: null, // viewport
            rootMargin: '0px',
            threshold: 0.1 // 10% do elemento visível para disparar
        };

        const scrollRevealObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, scrollRevealOptions);


        // =============================================
        // INICIALIZAÇÃO DA PÁGINA
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Aplica o tema salvo
            let currentTheme = 'dark';
            const savedTheme = localStorage.getItem('themePreference');
            const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
            if (savedTheme === 'light' || (!savedTheme && prefersLight)) {
                currentTheme = 'light';
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
            }
            const themeIcon = document.querySelector('#theme-toggle i');
            if (themeIcon) {
                themeIcon.classList.toggle('fa-moon', currentTheme === 'dark');
                themeIcon.classList.toggle('fa-sun', currentTheme === 'light');
            }

            // Listeners para botões flutuantes
            const themeToggleBtn = document.getElementById('theme-toggle');
            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', toggleTheme);
            }
            
            // Listeners para o modal
            const modalOverlay = document.getElementById('quick-view-modal-overlay');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            if (modalCloseBtn) modalCloseBtn.addEventListener('click', closeQuickViewModal);
            if (modalOverlay) modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) closeQuickViewModal();
            });
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modalOverlay && modalOverlay.classList.contains('active')) {
                    closeQuickViewModal();
                }
            });


            // Search Input Listeners
            const searchInput = document.getElementById('report-search-input');
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    appState.searchTerm = searchInput.value.trim();
                    debouncedShowAutocomplete(appState.searchTerm);
                    applyFiltersAndRender();
                });
                searchInput.addEventListener('focus', () => showAutocompleteResults(appState.searchTerm));
                searchInput.addEventListener('blur', hideAutocompleteResults);
                searchInput.addEventListener('keydown', (e) => {
                    const results = document.querySelectorAll('.autocomplete-item');
                    if (results.length === 0) return;

                    let activeIndex = -1;
                    results.forEach((item, index) => {
                        if (item.classList.contains('active')) {
                            activeIndex = index;
                        }
                    });

                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        activeIndex = (activeIndex + 1) % results.length;
                        results.forEach(item => item.classList.remove('active'));
                        results[activeIndex].classList.add('active');
                        searchInput.value = results[activeIndex].textContent;
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        activeIndex = (activeIndex - 1 + results.length) % results.length;
                        results.forEach(item => item.classList.remove('active'));
                        results[activeIndex].classList.add('active');
                        searchInput.value = results[activeIndex].textContent;
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (activeIndex !== -1) {
                            results[activeIndex].click();
                        } else {
                            appState.searchTerm = searchInput.value.toLowerCase();
                            applyFiltersAndRender();
                            hideAutocompleteResults();
                        }
                    }
                });
            }

            const debouncedShowAutocomplete = debounce(showAutocompleteResults, 200);

            // Load More Button Listener
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', () => {
                    playSound('load-more');
                    if (appState.loading) return;
                    appState.loading = true;
                    loadMoreBtn.disabled = true;
                    loadMoreBtn.querySelector('i').style.display = 'inline-block';
                    loadMoreBtn.lastChild.textContent = 'Carregando...';

                    setTimeout(() => {
                        appState.currentPage++;
                        const allFilteredAndPaged = getFilteredReports(true);
                        const reportsToAppend = allFilteredAndPaged.slice((appState.currentPage - 1) * REPORTS_PER_PAGE, appState.currentPage * REPORTS_PER_PAGE);
                        
                        const reportListContainer = document.getElementById('report-list');
                        reportsToAppend.forEach(report => {
                            const card = renderReportCard(report);
                            reportListContainer.appendChild(card);
                            scrollRevealObserver.observe(card);
                        });

                        appState.loading = false;
                        updateLoadMoreButton();
                    }, 500);
                });
            }

            // Atualiza data e hora no rodapé
            updateFooterDateTime();
            setInterval(updateFooterDateTime, 60 * 1000);

            // Barra de progresso de scroll da página
            window.addEventListener('scroll', debouncedUpdateScrollProgressBar);
            debouncedUpdateScrollProgressBar();

            // Carrega os dados dos relatórios
            fetchReportsData();
        });
    </script>
</body>
</html>
