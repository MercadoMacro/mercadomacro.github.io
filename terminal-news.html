<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Terminal News - Cripto & Finanças</title>
  <style>
    :root {
      --terminal-bg: #1b1c1d;
      --terminal-border: #333;
      --terminal-text: #eee;
      --terminal-accent: #f1c40f;
      --crypto-accent: #f1c40f;
      --finance-accent: #f1c40f;
      --terminal-link: #00ffcc;
      --terminal-hover: #f39c12;
      --terminal-success: #2ecc71;
      --button-bg: #333;
      --button-hover: #444;
    }
    
    body {
      background: var(--terminal-bg);
      font-family: 'Courier New', Courier, monospace;
      margin: 0;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      position: relative;
    }

    .news-widget {
      background-color: #000;
      border: 2px solid var(--terminal-border);
      border-radius: 6px;
      padding: 1rem;
      color: var(--terminal-text);
      height: fit-content;
      position: relative;
    }

    .crypto-widget {
      border-top: 3px solid var(--crypto-accent);
    }

    .finance-widget {
      border-top: 3px solid var(--finance-accent);
    }

    .refresh-widget {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      color: var(--terminal-text);
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .refresh-widget:hover {
      color: var(--terminal-accent);
    }

    .news-widget h3 {
      font-size: 1.1rem;
      color: var(--terminal-accent);
      margin-bottom: 0.5rem;
      border-bottom: 1px solid var(--terminal-border);
      padding-bottom: 0.5rem;
      display: flex;
      align-items: center;
      padding-right: 30px;
    }

    .news-widget h3 i {
      margin-right: 8px;
    }

    .news-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .news-list li {
      margin: 0.6rem 0;
      border-left: 3px solid var(--terminal-success);
      padding-left: 0.5rem;
    }

    .news-list a {
      text-decoration: none;
      color: var(--terminal-link);
      font-size: 0.9rem;
      display: inline-block;
      transition: color 0.2s;
    }

    .news-list a:hover {
      color: var(--terminal-hover);
    }

    .timestamp {
      font-size: 0.7rem;
      color: #777;
      margin-top: 10px;
      text-align: right;
    }

    .action-btn {
      position: fixed;
      bottom: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #000;
      color: var(--terminal-text);
      border: 1px solid var(--terminal-accent);
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .action-btn:hover {
      background-color: var(--terminal-accent);
      color: #000;
      transform: translateY(-3px);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    #refresh-btn {
      right: 20px;
    }

    #fullscreen-btn {
      right: 90px;
    }

    #fullscreen-exit-btn {
      right: 90px;
      display: none;
    }

    #home-btn {
      right: 160px;
    }

    #analises-btn {
      right: 230px;
    }

    #indicadores-btn {
      right: 300px;
    }

    #calculadoras-btn {
      right: 370px;
    }

    @media (max-width: 768px) {
      body {
        grid-template-columns: 1fr;
        padding-bottom: 80px;
      }
      
      .action-btn {
        width: 40px;
        height: 40px;
        bottom: 20px;
      }

      #refresh-btn {
        right: 20px;
      }

      #fullscreen-btn {
        right: 70px;
      }

      #fullscreen-exit-btn {
        right: 70px;
      }

      #home-btn {
        right: 120px;
      }

      #analises-btn {
        right: 170px;
      }

      #indicadores-btn {
        right: 220px;
      }

      #calculadoras-btn {
        right: 270px;
      }
    }

    @media (max-width: 480px) {
      #refresh-btn {
        right: 15px;
      }

      #fullscreen-btn {
        right: 60px;
      }

      #fullscreen-exit-btn {
        right: 60px;
      }

      #home-btn {
        right: 105px;
      }

      #analises-btn {
        right: 150px;
      }

      #indicadores-btn {
        display: none;
      }

      #calculadoras-btn {
        display: none;
      }
    }
  </style>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>

<!-- Seção Criptomoedas -->
<div class="news-widget crypto-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.guiadobitcoin)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-coins"></i> Guia do Bitcoin</h3>
  <ul class="news-list" id="guiadobitcoin-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="guiadobitcoin-timestamp"></div>
</div>

<div class="news-widget crypto-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.noticiabrasil)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-newspaper"></i> Notícia Brasil</h3>
  <ul class="news-list" id="noticiabrasil-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="noticiabrasil-timestamp"></div>
</div>

<div class="news-widget crypto-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.cointelegraph)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fab fa-bitcoin"></i> Cointelegraph</h3>
  <ul class="news-list" id="cointelegraph-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="cointelegraph-timestamp"></div>
</div>

<!-- Seção Mercado Financeiro Original -->
<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.advfn)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-newspaper"></i> ADVFN - Últimas Notícias</h3>
  <ul class="news-list" id="advfn-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="advfn-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.investing)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-chart-line"></i> Investing - Mercados</h3>
  <ul class="news-list" id="investing-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="investing-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.infomoney)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-money-bill-wave"></i> InfoMoney</h3>
  <ul class="news-list" id="infomoney-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="infomoney-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.valor)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-coins"></i> Valor Econômico</h3>
  <ul class="news-list" id="valor-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="valor-timestamp"></div>
</div>

<!-- Seção Mercado Financeiro Internacional -->
<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.dukascopy)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-chart-line"></i> Dukascopy</h3>
  <ul class="news-list" id="dukascopy-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="dukascopy-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.forexlive)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-dollar-sign"></i> ForexLive</h3>
  <ul class="news-list" id="forexlive-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="forexlive-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.fxmarkets)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-exchange-alt"></i> FX Markets</h3>
  <ul class="news-list" id="fxmarkets-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="fxmarkets-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.fxstreet)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-chart-bar"></i> FXStreet</h3>
  <ul class="news-list" id="fxstreet-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="fxstreet-timestamp"></div>
</div>

<div class="news-widget finance-widget">
  <button class="refresh-widget" onclick="loadNews(rssFeeds.ing)">
    <i class="fas fa-sync-alt"></i>
  </button>
  <h3><i class="fas fa-university"></i> ING Think</h3>
  <ul class="news-list" id="ing-news">
    <li>Carregando notícias...</li>
  </ul>
  <div class="timestamp" id="ing-timestamp"></div>
</div>

<!-- Botões flutuantes -->
<button id="refresh-btn" class="action-btn" aria-label="Atualizar tudo">
  <i class="fas fa-sync-alt"></i>
</button>

<button id="fullscreen-btn" class="action-btn" aria-label="Modo tela cheia">
  <i class="fas fa-expand"></i>
</button>

<button id="fullscreen-exit-btn" class="action-btn" aria-label="Sair do modo tela cheia">
  <i class="fas fa-compress"></i>
</button>

<button id="home-btn" class="action-btn" aria-label="Página inicial">
  <i class="fas fa-home"></i>
</button>

<button id="analises-btn" class="action-btn" aria-label="Análises">
  <i class="fas fa-chart-line"></i>
</button>

<button id="indicadores-btn" class="action-btn" aria-label="Indicadores">
  <i class="fas fa-chart-pie"></i>
</button>

<button id="calculadoras-btn" class="action-btn" aria-label="Calculadoras">
  <i class="fas fa-calculator"></i>
</button>

<script>
  // Variáveis globais para os botões de tela cheia
  let fullscreenBtn, fullscreenExitBtn;

  // Configurações de cache
  const CACHE_KEY = 'terminalNewsCache_v3';
  const CACHE_TTL = 15 * 60 * 1000; // 15 minutos

  // Configuração dos feeds RSS
  const rssFeeds = {
    // Criptomoedas
    guiadobitcoin: {
      url: 'https://guiadobitcoin.com.br/noticias/feed/',
      elementId: 'guiadobitcoin-news',
      timestampId: 'guiadobitcoin-timestamp',
      category: 'crypto'
    },
    noticiabrasil: {
      url: 'https://noticiabrasil.net.br/export/rss2/archive/index.xml',
      elementId: 'noticiabrasil-news',
      timestampId: 'noticiabrasil-timestamp',
      category: 'crypto'
    },
    cointelegraph: {
      url: 'https://br.cointelegraph.com/rss/tag/bitcoin',
      elementId: 'cointelegraph-news',
      timestampId: 'cointelegraph-timestamp',
      category: 'crypto'
    },
    
    // Mercado Financeiro Original
    advfn: {
      url: 'https://br.advfn.com/common/news/feeds/paperbr/rss',
      elementId: 'advfn-news',
      timestampId: 'advfn-timestamp',
      category: 'finance'
    },
    investing: {
      url: 'https://br.investing.com/rss/news.rss',
      elementId: 'investing-news',
      timestampId: 'investing-timestamp',
      category: 'finance'
    },
    infomoney: {
      url: 'https://www.infomoney.com.br/feed/',
      elementId: 'infomoney-news',
      timestampId: 'infomoney-timestamp',
      category: 'finance'
    },
    valor: {
      url: 'https://www.valor.com.br/rss',
      elementId: 'valor-news',
      timestampId: 'valor-timestamp',
      category: 'finance'
    },
    
    // Mercado Financeiro Internacional
    dukascopy: {
      url: 'https://www.dukascopy.com/fxspider/pt/rss/news_sector/finance/',
      elementId: 'dukascopy-news',
      timestampId: 'dukascopy-timestamp',
      category: 'finance',
      proxies: [
        `https://api.allorigins.win/get?charset=ISO-8859-1&url=${encodeURIComponent('https://www.dukascopy.com/fxspider/pt/rss/news_sector/finance/')}`,
        `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent('https://www.dukascopy.com/fxspider/pt/rss/news_sector/finance/')}`,
        `https://cors-anywhere.herokuapp.com/${encodeURIComponent('https://www.dukascopy.com/fxspider/pt/rss/news_sector/finance/')}`
      ]
    },
    forexlive: {
      url: 'https://www.forexlive.com/feed',
      elementId: 'forexlive-news',
      timestampId: 'forexlive-timestamp',
      category: 'finance'
    },
    fxmarkets: {
      url: 'https://www.fx-markets.com/feeds/rss',
      elementId: 'fxmarkets-news',
      timestampId: 'fxmarkets-timestamp',
      category: 'finance'
    },
    fxstreet: {
      url: 'https://www.fxstreet.com/rss/news',
      elementId: 'fxstreet-news',
      timestampId: 'fxstreet-timestamp',
      category: 'finance'
    },
    ing: {
      url: 'https://think.ing.com/rss/',
      elementId: 'ing-news',
      timestampId: 'ing-timestamp',
      category: 'finance'
    }
  };

  // Função para renderizar notícias
  function renderNews(listElement, timestampId, items) {
    listElement.innerHTML = '';
    const itemsToShow = items.slice(0, 6);
    
    if (itemsToShow.length === 0) {
      listElement.innerHTML = '<li><i class="fas fa-exclamation-circle"></i> Nenhuma notícia encontrada.</li>';
    } else {
      itemsToShow.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a>`;
        listElement.appendChild(li);
      });
    }
    
    const now = new Date();
    document.getElementById(timestampId).textContent = 
      `Atualizado: ${now.toLocaleTimeString('pt-BR')}`;
  }

  // Função para carregar notícias com tratamento especial para Dukascopy
  async function loadNews(feedConfig) {
    try {
      const list = document.getElementById(feedConfig.elementId);
      list.innerHTML = '<li><i class="fas fa-spinner fa-spin"></i> Atualizando...</li>';
      
      // Verificar cache
      const cacheKey = `${CACHE_KEY}_${feedConfig.elementId}`;
      const cachedData = localStorage.getItem(cacheKey);
      const cacheTime = localStorage.getItem(`${cacheKey}_time`);
      
      if (cachedData && cacheTime && (Date.now() - parseInt(cacheTime)) < CACHE_TTL) {
        const data = JSON.parse(cachedData);
        renderNews(list, feedConfig.timestampId, data.items);
        return;
      }
      
      let data;
      
      // Tratamento especial para feeds com múltiplos proxies
      if (feedConfig.proxies) {
        for (const proxyUrl of feedConfig.proxies) {
          try {
            const response = await fetch(proxyUrl);
            if (!response.ok) continue;
            
            const result = await response.json();
            
            // Ajuste para diferentes formatos de proxy
            if (proxyUrl.includes('allorigins.win')) {
              const xmlText = result.contents;
              // Converta para UTF-8 se necessário
              const decodedText = decodeURIComponent(escape(xmlText));
              const parser = new DOMParser();
              const xmlDoc = parser.parseFromString(decodedText, "text/xml");
              const items = xmlDoc.getElementsByTagName("item");
              data = { 
                items: Array.from(items).map(item => ({
                  title: item.getElementsByTagName("title")[0].textContent,
                  link: item.getElementsByTagName("link")[0].textContent
                })) 
              };
            } else if (proxyUrl.includes('rss2json.com')) {
              // Formato padrão do rss2json
              data = result;
            } else {
              // Outros proxies podem retornar o XML diretamente
              const xmlText = await result.text();
              const parser = new DOMParser();
              const xmlDoc = parser.parseFromString(xmlText, "text/xml");
              const items = xmlDoc.getElementsByTagName("item");
              data = { 
                items: Array.from(items).map(item => ({
                  title: item.getElementsByTagName("title")[0].textContent,
                  link: item.getElementsByTagName("link")[0].textContent
                })) 
              };
            }
            
            break; // Se conseguir com um proxy, sai do loop
          } catch (e) {
            console.log(`Proxy ${proxyUrl} falhou, tentando próximo...`, e);
          }
        }
      } else {
        // Código original para outros feeds
        const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedConfig.url)}&_=${Date.now()}`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        data = await response.json();
      }
      
      if (!data || !data.items) throw new Error('Dados do feed inválidos');
      
      // Salvar no cache e renderizar
      localStorage.setItem(cacheKey, JSON.stringify(data));
      localStorage.setItem(`${cacheKey}_time`, Date.now());
      renderNews(list, feedConfig.timestampId, data.items);
    } catch (error) {
      document.getElementById(feedConfig.elementId).innerHTML = 
        '<li><i class="fas fa-exclamation-triangle"></i> Erro ao carregar notícias.</li>';
      console.error(`Erro no feed ${feedConfig.elementId}:`, error);
    }
  }

  // Função para atualizar todos os feeds
  function refreshAllFeeds() {
    const refreshBtn = document.getElementById('refresh-btn');
    
    // Animação de carregamento
    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    refreshBtn.disabled = true;
    
    // Limpar cache antes de atualizar
    Object.keys(rssFeeds).forEach(feedKey => {
      const cacheKey = `${CACHE_KEY}_${rssFeeds[feedKey].elementId}`;
      localStorage.removeItem(cacheKey);
      localStorage.removeItem(`${cacheKey}_time`);
    });
    
    // Atualiza todos os feeds
    const promises = Object.values(rssFeeds).map(feed => loadNews(feed));
    
    // Restaura o botão quando terminar
    Promise.all(promises).finally(() => {
      setTimeout(() => {
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
        refreshBtn.disabled = false;
      }, 1000);
    });
  }

  // Função para alternar tela cheia
  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        console.error(`Erro ao tentar entrar em tela cheia: ${err.message}`);
      });
      fullscreenBtn.style.display = 'none';
      fullscreenExitBtn.style.display = 'flex';
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
        fullscreenExitBtn.style.display = 'none';
        fullscreenBtn.style.display = 'flex';
      }
    }
  }

  // Carrega todos os feeds quando a página é aberta
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializa os botões de tela cheia
    fullscreenBtn = document.getElementById('fullscreen-btn');
    fullscreenExitBtn = document.getElementById('fullscreen-exit-btn');
    
    refreshAllFeeds();
    
    // Configura os botões flutuantes
    document.getElementById('refresh-btn').addEventListener('click', refreshAllFeeds);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    fullscreenExitBtn.addEventListener('click', toggleFullscreen);
    
    document.getElementById('home-btn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
    
    document.getElementById('analises-btn').addEventListener('click', () => {
      window.location.href = 'analises.html';
    });
    
    document.getElementById('indicadores-btn').addEventListener('click', () => {
      window.location.href = 'indicadores.html';
    });
    
    document.getElementById('calculadoras-btn').addEventListener('click', () => {
      window.location.href = 'calculadoras.html';
    });

    // Verifica mudanças no modo de tela cheia
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        fullscreenExitBtn.style.display = 'none';
        fullscreenBtn.style.display = 'flex';
      }
    });
  });

  // Atualiza os feeds a cada 5 minutos
  setInterval(refreshAllFeeds, 300000);
</script>

</body>
</html>