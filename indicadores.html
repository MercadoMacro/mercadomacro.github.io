<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5JZRK5NNKG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5JZRK5NNKG');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta name="description" content="Indicadores atualizados do mercado financeiro do Brasil e EUA, incluindo CDS, SELIC, Dólar, Inflação, Fed Funds e PIB.">
    <meta name="keywords" content="indicadores financeiros, cds, selic, ipca, ipca-15, pib brasil, dolar, pib, fed funds, cpi, pce, fred api, bcb api, tesouro direto">
    <meta name="author" content="Anderson">
    <meta property="og:title" content="Indicadores de Mercado Financeiro - Mercado Macro">
    <meta property="og:description" content="Acompanhe os principais indicadores do mercado financeiro do Brasil e dos EUA em tempo real">
    <meta property="og:image" content="https://example.com/indicators-thumbnail.jpg">
    <meta property="og:url" content="https://mercadomacro.github.io/indicadores.html">
    <meta name="theme-color" content="#0d1117">
    <title>Indicadores Financeiros - Mercado Macro</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        :root { 
            --primary-color: #00d180; --primary-light: #5bffb0; --primary-dark: #009e53;
            --dark-bg: #0d1117; --darker-bg: #010409; --text-color: #c9d1d9;
            --text-secondary: rgba(139, 148, 158, 0.7); --card-bg-val: 22, 27, 34;
            --card-bg: rgba(var(--card-bg-val), 0.85); --border-color: rgba(48, 54, 61, 0.8);
            --shadow-color-soft: rgba(0, 0, 0, 0.2); --shadow-color-medium: rgba(0, 0, 0, 0.3);
            --up-trend: #3fb950; --down-trend: #f85149;
            --skeleton-bg: rgba(48, 54, 61, 0.5);
        }

        /* INÍCIO: ESTILOS DO NOVO CABEÇALHO PADRÃO */
        .header {
            padding: 0;
            text-align: center;
            position: relative;
            background-color: var(--dark-bg);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 var(--shadow-color-soft);
            z-index: 100;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 20px;
        }

        .logo {
            text-align: left;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 0;
        }
        .page-title-header {
            font-size: 28px;
            font-weight: 800;
            line-height: 1.2;
            letter-spacing: -1px;
            background: linear-gradient(120deg, var(--primary-light), var(--primary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            padding: 0;
            text-transform: uppercase;
        }
        .logo-divider {
            width: 70px;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            margin: 0;
            border-radius: 4px;
        }
        /* FIM: ESTILOS DO NOVO CABEÇALHO PADRÃO */

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%); color: var(--text-color); min-height: 100vh; width: 100%; overflow-x: hidden; line-height: 1.7; transition: background 0.3s ease, color 0.3s ease; display: flex; flex-direction: column; }
        :focus-visible { outline: 2px solid var(--primary-color); outline-offset: 2px; }
        .container { flex: 1; max-width: 1200px; width: 100%; margin: 0 auto; padding: 30px 20px; box-sizing: border-box; text-align: center; display: flex; flex-direction: column; }
        .subheader { font-size: 16px; margin-bottom: 25px; color: var(--text-secondary); font-weight: 600; }
        main { flex: 1; display: flex; flex-direction: column; width: 100%; }
        .indicators-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 8px 0 15px; width: 100%; flex-grow: 1; }
        
        @keyframes card-entry {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .indicator-card { 
            background: var(--card-bg); border-radius: 16px; box-shadow: 0 4px 12px var(--shadow-color-soft); padding: 0; 
            flex: 1 1 280px; max-width: calc(25% - 15px); text-align: center; transition: all 0.3s ease; 
            border: 1px solid var(--border-color); min-height: 190px; display: flex; flex-direction: column; 
            justify-content: center; position: relative; transform-style: preserve-3d; overflow: hidden; 
            perspective: 1000px;
            opacity: 0;
            animation: card-entry 0.5s forwards ease-out;
        }

        .indicator-card:nth-child(1) { animation-delay: 0.05s; } .indicator-card:nth-child(2) { animation-delay: 0.1s; } .indicator-card:nth-child(3) { animation-delay: 0.15s; } .indicator-card:nth-child(4) { animation-delay: 0.2s; } .indicator-card:nth-child(5) { animation-delay: 0.25s; } .indicator-card:nth-child(6) { animation-delay: 0.3s; } .indicator-card:nth-child(7) { animation-delay: 0.35s; } .indicator-card:nth-child(8) { animation-delay: 0.4s; }
        .indicator-card:nth-child(9) { animation-delay: 0.45s; } .indicator-card:nth-child(10) { animation-delay: 0.5s; } .indicator-card:nth-child(11) { animation-delay: 0.55s; } .indicator-card:nth-child(12) { animation-delay: 0.6s; } .indicator-card:nth-child(13) { animation-delay: 0.65s; } .indicator-card:nth-child(14) { animation-delay: 0.7s; }

        .indicator-card:focus-visible { border-color: var(--primary-color); box-shadow: 0 0 0 2px var(--dark-bg), 0 0 0 4px var(--primary-color); }
        .indicator-card.sortable-ghost { opacity: 0.4; }
        .indicator-card.sortable-chosen { box-shadow: 0 8px 20px var(--shadow-color-medium); transform: scale(1.02); cursor: grabbing; }
        .indicator-card--with-chart { min-height: 310px; max-width: calc(33.33% - 15px); }
        .indicator-card:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 8px 20px var(--shadow-color-medium); }
        
        .indicator-front, .indicator-back { 
            backface-visibility: hidden; -webkit-backface-visibility: hidden; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            padding: 12px 15px 12px 35px; display: flex; flex-direction: column; justify-content: space-around; 
            transition: transform 0.6s, opacity 0.3s; transform-style: preserve-3d; cursor: pointer; 
        }
        .indicator-back { transform: rotateY(180deg); font-size: 13px; color: var(--text-secondary); text-align: left; padding: 15px; overflow-y: auto; cursor: default;}
        .indicator-card.flipped .indicator-front { transform: rotateY(180deg); }
        .indicator-card.flipped .indicator-back { transform: rotateY(0deg); }
        
        .skeleton-loader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 12px 15px 12px 35px; display: flex; flex-direction: column; justify-content: space-around; background: var(--card-bg); opacity: 1; transition: opacity 0.5s ease; z-index: 2; }
        .card-loaded .skeleton-loader { opacity: 0; pointer-events: none; }
        .card-content { opacity: 0; transition: opacity 0.5s ease 0.2s; }
        .card-loaded .card-content { opacity: 1; }

        @keyframes shimmer { 0% { background-position: -468px 0; } 100% { background-position: 468px 0; } }
        .skeleton { background-color: var(--skeleton-bg); background-image: linear-gradient(to right, var(--skeleton-bg) 0%, rgba(255,255,255,0.05) 20%, var(--skeleton-bg) 40%, var(--skeleton-bg) 100%); background-repeat: no-repeat; background-size: 800px 104px; animation: shimmer 1.5s linear infinite; border-radius: 4px; }
        .skeleton.skeleton-title { width: 60%; height: 16px; margin: 0 auto 10px; }
        .skeleton.skeleton-value { width: 40%; height: 24px; margin: 5px auto; }
        .skeleton.skeleton-desc { width: 50%; height: 12px; margin: 5px auto; }
        .skeleton.skeleton-chart { flex-grow: 1; min-height: 80px; margin-top: 10px; }
        
        .indicator-back strong { color: var(--primary-color); display: block; margin-bottom: 6px; text-align: center; font-size: 14px; }
        .indicator-icon { font-size: 22px; color: var(--primary-color); margin-bottom: 6px; }
        .indicator-name { font-size: 13px; font-weight: 700; margin-bottom: 8px; color: var(--primary-color); text-transform: uppercase; letter-spacing: 0.5px; line-height: 1.3; }
        .indicator-value { font-size: 16px; font-weight: 700; margin: 5px 0; line-height: 1.3; }
        .indicator-description { font-size: 11px; color: var(--text-secondary); margin-bottom: 2px; line-height: 1.3; }
        
        .info-icon { position: absolute; top: 12px; right: 12px; color: var(--text-secondary); font-size: 14px; opacity: 0.7; transition: opacity 0.2s ease, color 0.2s ease; z-index: 5; }
        .indicator-card:hover .info-icon { opacity: 1; color: var(--primary-color); }

        .indicator-card--multi-value .indicator-front { padding-top: 10px; padding-bottom: 10px; }
        .indicator-card--multi-value .indicator-value { font-size: 15px; }
        #tesouro-card { min-height: 310px; }
        #tesouro-card .indicator-front { justify-content: center; }
        #tesouro-bond-selector { width: 90%; background: var(--darker-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 5px; padding: 6px; margin: 8px 0; font-family: 'Montserrat', sans-serif; font-weight: 600; cursor: pointer; }
        #tesouro-bond-selector:focus { outline: 1px solid var(--primary-color); }
        .sparkline-chart { min-height: 80px; margin: 8px 0; }
        .drag-handle { position: absolute; left: 0; top: 0; bottom: 0; width: 30px; display: flex; align-items: center; justify-content: center; color: rgba(139, 148, 158, 0.4); cursor: grab; transition: color 0.2s ease; z-index: 3;}
        .indicator-card:hover .drag-handle { color: rgba(139, 148, 158, 0.7); }
        .drag-handle:active { cursor: grabbing; }
        .chart-controls { display: flex; justify-content: center; gap: 8px; margin-top: 10px; }
        .chart-period-btn { background: rgba(var(--card-bg-val),0.5); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .chart-period-btn:hover { background: var(--primary-color); color: var(--dark-bg); }
        .chart-period-btn.active { background: var(--primary-dark); color: white; border-color: var(--primary-dark); }
        .accessible-chart-data { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
        .footer { font-size: 13px; margin-top: 40px; text-align: center; color: var(--text-secondary); padding: 20px 0; border-top: 1px solid var(--border-color); }
        .floating-btn { position: fixed; width: 50px; height: 50px; border-radius: 50%; background: rgba(var(--card-bg-val), 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-color); cursor: pointer; z-index: 1000; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1); overflow: hidden; will-change: transform, background-color, box-shadow; }
        .floating-btn::before { content: ''; position: absolute; top: -20%; left: -50%; width: 200%; height: 150%; background: linear-gradient( 145deg, rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0.1) 40%, rgba(255, 255, 255, 0) 80% ); transform: rotate(20deg); transition: all 0.4s ease; pointer-events: none; }
        .floating-btn:hover { transform: translateY(-6px) scale(1.01); background: rgba(var(--card-bg-val), 0.6); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4); color: #fff; }
        .floating-btn:hover::before { transform: translate(20px, -10px) rotate(20deg) scale(1.1); opacity: 0.8; }
        .floating-btn i { font-size: 18px; transition: color 0.3s ease, transform 0.3s ease; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .is-refreshing i { animation: spin 1s linear infinite; }

        #back-btn { right: 20px; bottom: 20px; }
        #refresh-btn { right: 80px; bottom: 20px; }
        #fullscreen-btn { right: 140px; bottom: 20px; }
        #fullscreen-exit-btn { right: 140px, bottom: 20px; display: none; }
        .theme-toggle { left: 20px; bottom: 20px; }
        
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .toast { padding: 12px 20px; border-radius: 8px; color: #fff; font-weight: 600; font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); animation: toast-in 0.5s cubic-bezier(0.215, 0.610, 0.355, 1) forwards; }
        .toast.success { background-color: rgba(63, 185, 80, 0.8); }
        .toast.error { background-color: rgba(248, 81, 73, 0.8); }
        @keyframes toast-in { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes toast-out { from { transform: translateY(0); opacity: 1; } to { transform: translateY(100px); opacity: 0; } }
        .toast.fade-out { animation: toast-out 0.5s cubic-bezier(0.600, 0.040, 0.980, 0.335) forwards; }
        
        .profile-btn { position: fixed; top: 20px; right: 20px; width: 45px; height: 45px; border-radius: 50%; background: rgba(var(--card-bg-val), 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--primary-color); cursor: pointer; z-index: 1000; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 5px 15px var(--shadow-color-soft); }
        .profile-btn i { font-size: 18px; }
        .profile-btn:hover { background: var(--primary-color); color: var(--dark-bg); transform: translateY(-2px) scale(1.05); }
        .switch-container { display: flex; align-items: center; justify-content: center; margin: 0; gap: 12px; font-weight: 600; font-size: 14px; color: var(--text-secondary); }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:focus + .slider { box-shadow: 0 0 1px var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }
        .switch-label { transition: color .3s ease; }
        .switch-label.active { color: var(--text-color); }

        .card-switch-container { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 11px; margin: 4px 0 8px; color: var(--text-secondary); font-weight: 600; }
        .card-switch-container .switch { width: 40px; height: 22px; }
        .card-switch-container .slider:before { height: 16px; width: 16px; }
        .card-switch-container input:checked + .slider:before { transform: translateX(18px); }
        .card-switch-label { transition: color .3s ease; }
        .card-switch-label.active { color: var(--text-color); }

        .yield-controls { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
        .yield-btn { background: rgba(var(--card-bg-val),0.5); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .yield-btn:hover { background: var(--primary-color); color: var(--dark-bg); }
        .yield-btn.active { background: var(--primary-dark); color: white; border-color: var(--primary-dark); }

        body.light-mode { --primary-color: #007bff; --primary-light: #53a6ff; --primary-dark: #0056b3; --dark-bg: #f8f9fa; --darker-bg: #e9ecef; --text-color: #212529; --text-secondary: #495057; --card-bg-val: 255, 255, 255; --card-bg: #ffffff; --border-color: #dee2e6; --shadow-color-soft: rgba(0,0,0,0.07); --shadow-color-medium: rgba(0,0,0,0.1); background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%); --skeleton-bg: #e0e0e0; }
        body.light-mode .page-title-header { background: linear-gradient(120deg, var(--primary-dark), var(--primary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        body.light-mode .logo-divider { background: linear-gradient(to right, var(--primary-color), var(--primary-light));}
        body.light-mode .floating-btn { background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(0, 0, 0, 0.1); color: var(--text-secondary); box-shadow: 0 8px 20px var(--shadow-color-soft); }
        body.light-mode .floating-btn::before { background: linear-gradient( 145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.4) 40%, rgba(255, 255, 255, 0) 80% ); }
        body.light-mode .floating-btn:hover { background: rgba(255, 255, 255, 0.85); color: var(--primary-dark); }
        body.light-mode .profile-btn { background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(0, 0, 0, 0.1); color: var(--primary-color); }
        body.light-mode .profile-btn:hover { background-color: var(--primary-color); color: white; }
        body.light-mode .yield-btn:hover { background: var(--primary-color); color: white; }
        body.light-mode .yield-btn.active { background: var(--primary-dark); border-color: var(--primary-dark); }
        body.light-mode #tesouro-bond-selector { background-color: #f8f9fa; color: #212529; border-color: #dee2e6;}
        
        @media (max-width: 1200px) { .indicator-card { max-width: calc(33.33% - 15px); } .indicator-card--with-chart { max-width: calc(50% - 15px); } }
        @media (max-width: 992px) {
            .header .logo-container { flex-direction: column; align-items: center; gap: 15px; padding: 10px 15px; }
            .header .logo .page-title-header { font-size: 26px; text-align: center; }
            .header .logo .logo-divider { margin: 5px auto; }
            
        }
        @media (max-width: 768px) { .indicator-card { max-width: calc(50% - 15px); } .indicator-card--with-chart { max-width: calc(50% - 15px); } .page-title-header { font-size: 26px; } }
        @media (max-width: 600px) { .indicator-card { max-width: 100%; } .indicator-card--with-chart { max-width: 100%; } .container { padding: 15px 12px; } .page-title-header { font-size: 24px; } .floating-btn, .profile-btn { width: 45px; height: 45px; } #back-btn { right: 15px; } #refresh-btn { right: 70px; } #fullscreen-btn, #fullscreen-exit-btn { right: 125px; } .theme-toggle { left: 15px; } .profile-btn { top: 15px; right: 15px; } }
        @supports(padding: max(0px)) { .floating-btn, .theme-toggle { bottom: max(15px, env(safe-area-inset-bottom)); } .profile-btn { top: max(15px, env(safe-area-inset-top)); right: max(15px, env(safe-area-inset-right)); } }
		
		#tesouro-card { width: 350px; height: 350px; flex: none; }
        .indicator-status, .indicator-times, .indicator-quote-time { font-size: 11px; color: var(--text-secondary); margin-bottom: 2px; line-height: 1.3; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <div class="logo">
                <div class="page-title-header">Indicadores Financeiros</div>
                <div class="logo-divider"></div>
            </div>
            

            </div>
        </div>
    </header>

    <div class="container">
        <p class="subheader" id="data-atual"></p>
		                <div class="switch-container">
                    <span id="label-nacional" class="switch-label active">Nacionais</span>
                    <label class="switch">
                        <input type="checkbox" id="view-toggle-switch">
                        <span class="slider round"></span>
                    </label>
                    <span id="label-internacional" class="switch-label">Internacionais</span>
                </div>
        
        <main>
            <div class="indicators-container" id="national-indicators-container">
                <article class="indicator-card indicator-card--with-chart" data-id="risk" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-shield-alt"></i></div><div class="indicator-name">Risco País (CDS 5 Anos)</div><div class="indicator-value" id="risk-value"></div><div class="indicator-description">CDS (pontos-base)</div><div class="sparkline-chart" id="risk-chart-container"></div><div class="accessible-chart-data" id="risk-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o CDS?</strong> O Credit Default Swap (CDS) é um contrato de seguro contra o calote da dívida de um país. A pontuação do CDS de 5 anos indica a percepção de risco dos investidores internacionais. Quanto maior o valor, maior o risco soberano percebido.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value" id="tesouro-card" data-id="tesouro" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title" style="height: 20px;"></div><div class="skeleton" style="width: 90%; height: 35px; margin: 10px auto;"></div><div class="skeleton skeleton-value" style="margin-top: 15px;"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value" style="margin-top: 15px;"></div><div class="skeleton skeleton-desc"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-landmark"></i></div><div class="indicator-name">Taxas Tesouro Direto</div><select id="tesouro-bond-selector" aria-label="Selecione um título do Tesouro Direto"></select><div class="indicator-value" id="tesouro-rate-value"></div><div class="indicator-description">Rendimento Anual</div><div class="indicator-value" id="tesouro-price-value"></div><div class="indicator-description">Preço Unitário</div><div class="indicator-status" id="tesouro-market-status"></div><div class="indicator-times" id="tesouro-market-times"></div><div class="indicator-description" id="tesouro-quote-time"></div></div><div class="indicator-back"><strong>O que é o Tesouro Direto?</strong> É um programa do Tesouro Nacional do Brasil para venda de títulos públicos federais para pessoas físicas, de forma 100% online. É considerado um dos investimentos de menor risco na economia. Este card mostra as taxas de rendimento e os preços no momento da compra.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="dolar" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-dollar-sign"></i></div><div class="indicator-name">Dólar</div><div class="indicator-value" id="dolar-buy-value"></div><div class="indicator-description">Compra</div><div class="indicator-value" id="dolar-sell-value"></div><div class="indicator-description">Venda</div><div class="sparkline-chart" id="dolar-chart-container"></div><div class="chart-controls" data-indicator-id="dolarSell"><button class="chart-period-btn" data-days="30">30D</button><button class="chart-period-btn" data-days="90">90D</button><button class="chart-period-btn active" data-days="365">1A</button></div><div class="accessible-chart-data" id="dolar-chart-data-table"></div></div><div class="indicator-back"><strong>O que é a PTAX?</strong> A PTAX é a taxa de câmbio de referência oficial do Brasil, calculada diariamente pelo Banco Central. Ela representa a média das taxas de negociação de Dólar no mercado interbancário.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="euro" tabindex="0">
                     <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-euro-sign"></i></div><div class="indicator-name">Euro</div><div class="indicator-value" id="euro-buy-value"></div><div class="indicator-description">Compra</div><div class="indicator-value" id="euro-sell-value"></div><div class="indicator-description">Venda</div><div class="sparkline-chart" id="euro-chart-container"></div><div class="chart-controls" data-indicator-id="euroSell"><button class="chart-period-btn" data-days="30">30D</button><button class="chart-period-btn" data-days="90">90D</button><button class="chart-period-btn active" data-days="365">1A</button></div><div class="accessible-chart-data" id="euro-chart-data-table"></div></div><div class="indicator-back"><strong>Cotação do Euro</strong> A cotação do Euro contra o Real é apurada pelo Banco Central. O valor representa quantos Reais são necessários para comprar um Euro, com base nas negociações do mercado.</div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="cdi" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-chart-line"></i></div><div class="indicator-name">CDI</div><div class="indicator-value" id="cdi-annual-value"></div><div class="indicator-description">Taxa Anual (a.a.)</div><div class="sparkline-chart" id="cdi-chart-container"></div><div class="chart-controls" data-indicator-id="cdi"><button class="chart-period-btn" data-days="30">30D</button><button class="chart-period-btn" data-days="90">90D</button><button class="chart-period-btn active" data-days="365">1A</button></div><div class="accessible-chart-data" id="cdi-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o CDI?</strong> É a taxa de juros dos empréstimos entre bancos. Serve de referência para a maioria dos investimentos de renda fixa. A taxa anual é uma projeção baseada na composição da taxa diária.</div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="selic" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-percentage"></i></div><div class="indicator-name">Selic</div><div class="indicator-value" id="selic-meta-value"></div><div class="indicator-description">Meta ao Ano</div><div class="sparkline-chart" id="selic-chart-container"></div><div class="chart-controls" data-indicator-id="selicMeta"><button class="chart-period-btn" data-days="30">30D</button><button class="chart-period-btn" data-days="90">90D</button><button class="chart-period-btn active" data-days="365">1A</button></div><div class="accessible-chart-data" id="selic-chart-data-table"></div></div><div class="indicator-back"><strong>O que é a Selic?</strong> A Taxa Selic é a taxa básica de juros da economia brasileira, definida pelo COPOM. Ela influencia todas as outras taxas de juros do país.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="ipca" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-chart-pie"></i></div><div class="indicator-name">IPCA</div><div class="indicator-value" id="ipca-month-value"></div><div class="indicator-description">Mês</div><div class="indicator-value" id="ipca-12m-value"></div><div class="indicator-description">12 Meses</div><div class="sparkline-chart" id="ipca-chart-container"></div><div class="chart-controls" data-indicator-id="ipca"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="ipca-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o IPCA?</strong> O IPCA é o principal indicador de inflação do Brasil, medindo a variação de preços para o consumidor final. É a meta de inflação oficial.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="ipca15" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-tasks"></i></div><div class="indicator-name">IPCA-15</div><div class="indicator-value" id="ipca15-month-value"></div><div class="indicator-description">Mês</div><div class="indicator-value" id="ipca15-12m-value"></div><div class="indicator-description">12 Meses</div><div class="sparkline-chart" id="ipca15-chart-container"></div><div class="chart-controls" data-indicator-id="ipca15"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="ipca15-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o IPCA-15?</strong> É uma prévia da inflação oficial (IPCA). A diferença está no período de coleta, que vai do dia 16 do mês anterior até o dia 15 do mês de referência, funcionando como um termômetro da tendência dos preços.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="inpc" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-wallet"></i></div><div class="indicator-name">INPC</div><div class="indicator-value" id="inpc-month-value"></div><div class="indicator-description">Mês</div><div class="indicator-value" id="inpc-12m-value"></div><div class="indicator-description">12 Meses</div><div class="sparkline-chart" id="inpc-chart-container"></div><div class="chart-controls" data-indicator-id="inpc"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="inpc-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o INPC?</strong> O Índice Nacional de Preços ao Consumidor mede a inflação para famílias de menor renda (1 a 5 salários mínimos). É muito usado em reajustes salariais.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="igpm" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-chart-area"></i></div><div class="indicator-name">IGP-M</div><div class="indicator-value" id="igp-m-month-value"></div><div class="indicator-description">Mês</div><div class="indicator-value" id="igp-m-12m-value"></div><div class="indicator-description">12 Meses</div><div class="sparkline-chart" id="igpm-chart-container"></div><div class="chart-controls" data-indicator-id="igpm"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="igpm-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o IGP-M?</strong> O IGP-M é um importante indicador de inflação, conhecido como a "inflação do aluguel" por ser muito usado para reajustar contratos de locação.</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="igpdi" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-chart-bar"></i></div><div class="indicator-name">IGP-DI</div><div class="indicator-value" id="igp-di-month-value"></div><div class="indicator-description">Mês</div><div class="indicator-value" id="igp-di-12m-value"></div><div class="indicator-description">12 Meses</div><div class="sparkline-chart" id="igpdi-chart-container"></div><div class="chart-controls" data-indicator-id="igpdi"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="igpdi-chart-data-table"></div></div><div class="indicator-back"><strong>O que é o IGP-DI?</strong> O Índice Geral de Preços - Disponibilidade Interna (IGP-DI) mede a variação de preços desde matérias-primas agrícolas e industriais até bens e serviços finais.</div></div>
                </article> 
                <article class="indicator-card indicator-card--with-chart" data-id="pib-br" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-building-columns"></i></div><div class="indicator-name">PIB Anual (Brasil)</div><div class="indicator-value" id="pib-br-value"></div><div class="indicator-description">Último Ano (R$ tri)</div><div class="sparkline-chart" id="pib-br-chart-container"></div><div class="chart-controls" data-indicator-id="pibBr"><button class="chart-period-btn" data-years="10">10A</button><button class="chart-period-btn" data-years="25">25A</button><button class="chart-period-btn active" data-years="max">Máx</button></div><div class="accessible-chart-data" id="pib-br-chart-data-table"></div></div><div class="indicator-back"><strong>PIB Anual (Valores Correntes)</strong> Representa a soma de todos os bens e serviços finais produzidos no país, medido em Reais (R$) a preços correntes do ano.<br><strong>Fonte:</strong> BCB (Série SGS 1208).</div></div>
                </article>
                <article class="indicator-card indicator-card--multi-value indicator-card--with-chart" data-id="poupanca" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-piggy-bank"></i></div><div class="indicator-name">Poupança</div><div class="indicator-value" id="poupanca-month-value"></div><div class="indicator-description">Rendimento no Mês</div><div class="indicator-value" id="poupanca-annualized-value"></div><div class="indicator-description">Rendimento Anualizado</div><div class="sparkline-chart" id="poupanca-chart-container"></div><div class="chart-controls" data-indicator-id="poupanca"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="poupanca-chart-data-table"></div></div><div class="indicator-back"><strong>Como funciona a Poupança?</strong> A remuneração, isenta de Imposto de Renda para pessoas físicas, é composta pela Taxa Referencial (TR) mais um rendimento adicional. Para depósitos feitos a partir de 04/05/2012, a regra é: se a meta Selic estiver acima de 8,5% ao ano, o rendimento é de 0,5% ao mês + TR. Se estiver igual ou abaixo de 8,5%, o rendimento é de 70% da meta Selic + TR.</div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="desemprego" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-user-times"></i></div><div class="indicator-name">Desemprego</div><div class="indicator-value" id="desemprego-value"></div><div class="indicator-description">Taxa de Desocupação</div><div class="sparkline-chart" id="desemprego-chart-container"></div><div class="chart-controls" data-indicator-id="desemprego"><button class="chart-period-btn" data-months="3">3M</button><button class="chart-period-btn" data-months="6">6M</button><button class="chart-period-btn active" data-months="12">1A</button></div><div class="accessible-chart-data" id="desemprego-chart-data-table"></div></div><div class="indicator-back"><strong>O que é a Taxa de Desemprego?</strong> Proporção de pessoas desocupadas na força de trabalho. Importante indicador da saúde do mercado de trabalho. Dado da PNAD Contínua/IBGE.</div></div>
                </article>
            </div>
            
            <div class="indicators-container" id="international-indicators-container" style="display: none;">
                <article class="indicator-card indicator-card--with-chart" data-id="cpi" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:80%; height:20px; margin: 4px auto;"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-shopping-basket"></i></div><div class="indicator-name">CPI (EUA)</div><div class="card-switch-container"><span class="card-switch-label active" data-type="anual">Anual</span><label class="switch"><input type="checkbox" id="cpi-toggle-switch"><span class="slider round"></span></label><span class="card-switch-label" data-type="mensal">Mensal</span></div><div class="indicator-value" id="cpi-value"></div><div class="indicator-description" id="cpi-date"></div><div class="sparkline-chart" id="cpi-chart"></div><div class="chart-controls" data-indicator-id="cpi"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>CPI (Consumer Price Index)</strong>Mede a variação de preços de uma cesta de consumo. Principal indicador de inflação ao consumidor dos EUA.<br><i>Série: CPIAUCSL</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="core-cpi" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:80%; height:20px; margin: 4px auto;"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-filter"></i></div><div class="indicator-name">Core CPI (Núcleo)</div><div class="card-switch-container"><span class="card-switch-label active" data-type="anual">Anual</span><label class="switch"><input type="checkbox" id="core-cpi-toggle-switch"><span class="slider round"></span></label><span class="card-switch-label" data-type="mensal">Mensal</span></div><div class="indicator-value" id="core-cpi-value"></div><div class="indicator-description" id="core-cpi-date"></div><div class="sparkline-chart" id="core-cpi-chart"></div><div class="chart-controls" data-indicator-id="coreCpi"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Core CPI</strong>Exclui os preços voláteis de alimentos e energia para medir a tendência da inflação.<br><i>Série: CPILFESL</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="pce" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:80%; height:20px; margin: 4px auto;"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-money-bill-wave"></i></div><div class="indicator-name">PCE (EUA)</div><div class="card-switch-container"><span class="card-switch-label active" data-type="anual">Anual</span><label class="switch"><input type="checkbox" id="pce-toggle-switch"><span class="slider round"></span></label><span class="card-switch-label" data-type="mensal">Mensal</span></div><div class="indicator-value" id="pce-value"></div><div class="indicator-description" id="pce-date"></div><div class="sparkline-chart" id="pce-chart"></div><div class="chart-controls" data-indicator-id="pce"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>PCE (Personal Consumption Expenditures)</strong>Mede a inflação de todos os gastos de consumo. É o indicador preferido pelo Fed.<br><i>Série: PCEPI</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="core-pce" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:80%; height:20px; margin: 4px auto;"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-gem"></i></div><div class="indicator-name">Core PCE (Núcleo)</div><div class="card-switch-container"><span class="card-switch-label active" data-type="anual">Anual</span><label class="switch"><input type="checkbox" id="core-pce-toggle-switch"><span class="slider round"></span></label><span class="card-switch-label" data-type="mensal">Mensal</span></div><div class="indicator-value" id="core-pce-value"></div><div class="indicator-description" id="core-pce-date"></div><div class="sparkline-chart" id="core-pce-chart"></div><div class="chart-controls" data-indicator-id="corePce"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Core PCE</strong>Exclui alimentos e energia do PCE. Usado pelo Fed para avaliar a política monetária.<br><i>Série: PCEPILFE</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="fedfunds" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-landmark"></i></div><div class="indicator-name">Fed Funds Rate</div><div class="indicator-value" id="fedfunds-value"></div><div class="indicator-description" id="fedfunds-date"></div><div class="sparkline-chart" id="fedfunds-chart"></div><div class="chart-controls" data-indicator-id="fedfunds"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Fed Funds Rate</strong>A taxa de juros básica da economia dos EUA, definida pelo Federal Reserve (Fed).<br><i>Série: FEDFUNDS (Diária)</i></div></div>
                </article> 
                <article class="indicator-card indicator-card--with-chart" data-id="fedtarget" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:80%; height:20px; margin: 4px auto;"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-bullseye"></i></div><div class="indicator-name">Fed Target Range</div><div class="card-switch-container"><span class="card-switch-label active" data-type="teto">Teto</span><label class="switch"><input type="checkbox" id="fedtarget-toggle-switch"><span class="slider round"></span></label><span class="card-switch-label" data-type="piso">Piso</span></div><div class="indicator-value" id="fedtarget-value"></div><div class="indicator-description" id="fedtarget-date"></div><div class="sparkline-chart" id="fedtarget-chart"></div><div class="chart-controls" data-indicator-id="fedtarget"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Meta da Fed Funds Rate</strong> O intervalo (piso e teto) que o Fed estabelece como meta para a taxa de juros básica. Alterne entre Teto e Piso para ver o valor e o histórico de cada um.<br><i>Séries: DFEDTARU (Teto), DFEDTARL (Piso)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="treasuries" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton" style="width:90%; height:28px; margin: 0 auto;"></div><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="yield-controls"><button class="yield-btn" data-yield="2Y">2 Anos</button><button class="yield-btn active" data-yield="10Y">10 Anos</button><button class="yield-btn" data-yield="30Y">30 Anos</button></div><div class="indicator-icon" style="margin-bottom: 0;"><i class="fas fa-file-invoice-dollar"></i></div><div class="indicator-name">Treasury Yields</div><div class="indicator-value" id="treasury-value"></div><div class="indicator-description" id="treasury-date"></div><div class="sparkline-chart" id="treasury-chart"></div><div class="chart-controls" data-indicator-id="treasury"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Treasury Yields</strong>Rendimento dos títulos do tesouro dos EUA. São referência para o custo do dinheiro no mundo. Selecione um prazo (2, 10 ou 30 anos) para ver seu rendimento e histórico.<br><i>Séries: DGS2, DGS10, DGS30</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="inflation-exp" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-eye"></i></div><div class="indicator-name">Expectativa de Inflação</div><div class="indicator-value" id="inflation-exp-value"></div><div class="indicator-description" id="inflation-exp-date">5 Anos (Breakeven)</div><div class="sparkline-chart" id="inflation-exp-chart"></div><div class="chart-controls" data-indicator-id="inflationExp"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>5-Year Breakeven Inflation</strong>Mede a expectativa de inflação do mercado para os próximos 5 anos.<br><i>Série: T5YIE (Diária)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="yield-curve" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-wave-square"></i></div><div class="indicator-name">Curva de Juros</div><div class="indicator-value" id="yield-curve-value"></div><div class="indicator-description" id="yield-curve-date">Spread 10Y-2Y (p.p.)</div><div class="sparkline-chart" id="yield-curve-chart"></div><div class="chart-controls" data-indicator-id="yieldCurve"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Yield Curve (10Y-2Y)</strong>Diferença entre os juros dos títulos de 10 e 2 anos. É um indicador preditivo de recessões. Quando negativo (curva invertida), sinaliza uma forte expectativa de desaceleração econômica.<br><i>Série: T10Y2Y</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="gdp-real" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-chart-line"></i></div><div class="indicator-name">PIB Real (EUA)</div><div class="indicator-value" id="gdp-real-value"></div><div class="indicator-description" id="gdp-real-date">Variação Anual</div><div class="sparkline-chart" id="gdp-real-chart"></div><div class="chart-controls" data-indicator-id="gdpReal"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>PIB Real (Real GDP)</strong>Mede o valor de todos os bens e serviços produzidos, ajustado pela inflação. Principal medida de crescimento econômico.<br><i>Série: GDPC1 (Trimestral)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="gdp-nominal" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-dollar-sign"></i></div><div class="indicator-name">PIB Nominal (EUA)</div><div class="indicator-value" id="gdp-nominal-value"></div><div class="indicator-description" id="gdp-nominal-date">Total em Dólares</div><div class="sparkline-chart" id="gdp-nominal-chart"></div><div class="chart-controls" data-indicator-id="gdpNominal"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>PIB Nominal (Nominal GDP)</strong>Mede o valor de todos os bens e serviços produzidos a preços correntes, sem ajustar pela inflação.<br><i>Série: GDP (Trimestral)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="unemployment" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-user-slash"></i></div><div class="indicator-name">Taxa de Desemprego</div><div class="indicator-value" id="unemployment-value"></div><div class="indicator-description" id="unemployment-date"></div><div class="sparkline-chart" id="unemployment-chart"></div><div class="chart-controls" data-indicator-id="unemployment"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Taxa de Desemprego (EUA)</strong>Percentual da força de trabalho que está desempregada e procurando por emprego.<br><i>Série: UNRATE (Mensal)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="payrolls" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-users"></i></div><div class="indicator-name">Nonfarm Payrolls</div><div class="indicator-value" id="payrolls-value"></div><div class="indicator-description" id="payrolls-date">Criação de Vagas</div><div class="sparkline-chart" id="payrolls-chart"></div><div class="chart-controls" data-indicator-id="payrolls"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Payrolls (Total Nonfarm)</strong>Mede a criação (ou destruição) de postos de trabalho não-agrícolas. É um dos indicadores mais importantes do mercado de trabalho.<br><i>Série: PAYEMS (Mensal)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="indpro" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-industry"></i></div><div class="indicator-name">Produção Industrial</div><div class="indicator-value" id="indpro-value"></div><div class="indicator-description" id="indpro-date">Variação Anual</div><div class="sparkline-chart" id="indpro-chart"></div><div class="chart-controls" data-indicator-id="indpro"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>Produção Industrial</strong>Mede a produção das fábricas, minas e serviços de utilidade pública. Um indicador da saúde do setor industrial.<br><i>Série: INDPRO (Mensal)</i></div></div>
                </article>
                <article class="indicator-card indicator-card--with-chart" data-id="sentiment" tabindex="0">
                    <div class="skeleton-loader"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-value"></div><div class="skeleton skeleton-desc"></div><div class="skeleton skeleton-chart"></div></div>
                    <div class="card-content"><div class="indicator-front"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="info-icon" title="Clique para mais detalhes"><i class="fas fa-info-circle"></i></div><div class="indicator-icon"><i class="fas fa-smile-beam"></i></div><div class="indicator-name">Confiança do Consumidor</div><div class="indicator-value" id="sentiment-value"></div><div class="indicator-description" id="sentiment-date">Índice (U. Michigan)</div><div class="sparkline-chart" id="sentiment-chart"></div><div class="chart-controls" data-indicator-id="sentiment"><button class="chart-period-btn" data-years="1">1A</button><button class="chart-period-btn active" data-years="5">5A</button><button class="chart-period-btn" data-years="max">Máx</button></div></div><div class="indicator-back"><strong>U. of Michigan: Consumer Sentiment</strong>Mede o nível de confiança dos consumidores na economia. Um indicador antecedente dos gastos de consumo.<br><i>Série: UMCSENT (Mensal)</i></div></div>
                </article>
            </div>
        </main>
        
        <footer class="footer" id="footer"></footer>
    </div>
    
    <div id="toast-container"></div>

    <a href="api.html" class="profile-btn floating-btn" aria-label="Análise de Perfil do Investidor"> <i class="fas fa-user-tie"></i></a>
    <button id="back-btn" class="floating-btn" aria-label="Voltar para página inicial"> <i class="fas fa-home"></i></button>
    <button id="refresh-btn" class="floating-btn" aria-label="Atualizar dados"> <i class="fas fa-redo"></i></button>
    <button id="fullscreen-btn" class="floating-btn" aria-label="Modo tela cheia"> <i class="fas fa-expand"></i></button>
    <button id="fullscreen-exit-btn" class="floating-btn" aria-label="Sair do modo tela cheia" style="display:none;"> <i class="fas fa-compress"></i></button>
    <button class="theme-toggle floating-btn" id="theme-toggle" aria-label="Alternar tema claro/escuro"> <i class="fas fa-moon"></i></button>

    <script>
        // --- 0. CACHE SERVICE ---
        const cacheService = {
            CACHE_TTL: 15 * 60 * 1000, 
            get(key) {
                const itemStr = localStorage.getItem(key);
                if (!itemStr) return null;
                try {
                    const item = JSON.parse(itemStr);
                    const isExpired = (Date.now() - item.timestamp) > this.CACHE_TTL;
                    return isExpired ? null : item.data;
                } catch (e) {
                    console.error("Erro ao ler cache:", e);
                    localStorage.removeItem(key);
                    return null;
                }
            },
            set(key, data) {
                const item = { data: data, timestamp: Date.now() };
                try {
                    localStorage.setItem(key, JSON.stringify(item));
                } catch (e) {
                    console.error("Erro ao salvar no cache:", e);
                }
            }
        };

        // --- 1. CONFIGURATION ---
        const config = {
            apiBaseUrl: 'https://api.bcb.gov.br/dados/serie/bcdata.sgs.',
            cdsApiUrl: 'https://corsproxy.io/?' + encodeURIComponent('https://br.investing.com/rates-bonds/brazil-cds-5-years-usd'),
            tesouroApiUrl: 'https://corsproxy.io/?' + encodeURIComponent('https://www.tesourodireto.com.br/json/br/com/b3/tesourodireto/service/api/treasurybondsinfo.json'),
            fredApiBaseUrl: 'https://api.stlouisfed.org/fred/series/observations',
            fredApiKey: 'fa2a8abda0c82b9b6bf1d4667e8a3a42', // ATENÇÃO: Chave de API exposta. O ideal é usar um backend para proteger esta chave.
            errorText: 'Erro',
            errorTextFriendly: 'Falha ao carregar',
            loadingText: '',
            selectors: {
                updateTime: '#data-atual', footer: '#footer', riskValue: '#risk-value', dolarBuy: '#dolar-buy-value',
                dolarSell: '#dolar-sell-value', euroBuy: '#euro-buy-value', euroSell: '#euro-sell-value',
                cdiAnnual: '#cdi-annual-value', selicMeta: '#selic-meta-value', ipcaMonth: '#ipca-month-value',
                ipca12m: '#ipca-12m-value', ipca15Month: '#ipca15-month-value', ipca1512m: '#ipca15-12m-value', 
                inpcMonth: '#inpc-month-value', inpc12m: '#inpc-12m-value',
                igpmMonth: '#igp-m-month-value', igpm12m: '#igp-m-12m-value', igpdiMonth: '#igp-di-month-value',
                igpdi12m: '#igp-di-12m-value', poupancaMonth: '#poupanca-month-value', poupancaAnnualized: '#poupanca-annualized-value',
                desemprego: '#desemprego-value',
                tesouroSelector: '#tesouro-bond-selector', tesouroRate: '#tesouro-rate-value', tesouroPrice: '#tesouro-price-value',
                tesouroMarketStatus: '#tesouro-market-status', 
                tesouroMarketTimes: '#tesouro-market-times',   
                tesouroQuoteTime: '#tesouro-quote-time'        
            },
            apiCodes: {
                dolarBuy: 1, dolarSell: 10813, euroBuy: 21619, euroSell: 21620, cdi: 12, selicMeta: 432, 
                ipca: 433, ipca15: 7478, inpc: 188, igpm: 189, igpdi: 190, 
                pibBr: 1208,
                poupanca: 195, desemprego: 24369
            },
            fredApiCodes: {
                cpi: 'CPIAUCSL', coreCpi: 'CPILFESL', pce: 'PCEPI', corePce: 'PCEPILFE', fedfunds: 'FEDFUNDS', 
                fedTargetUpper: 'DFEDTARU', fedTargetLower: 'DFEDTARL', treasury2Y: 'DGS2', treasury10Y: 'DGS10', 
                treasury30Y: 'DGS30', inflationExp: 'T5YIE', yieldCurve: 'T10Y2Y', gdpReal: 'GDPC1', 
                gdpNominal: 'GDP', unemployment: 'UNRATE', payrolls: 'PAYEMS', indpro: 'INDPRO', sentiment: 'UMCSENT'
            },
            fredIndicatorsConfig: {
                cpi: { name: 'CPI', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'lin', frequency: 'm' }, descriptionText: '', hasToggle: true },
                coreCpi: { name: 'Core CPI', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'lin', frequency: 'm' }, descriptionText: '', hasToggle: true },
                pce: { name: 'PCE', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'lin', frequency: 'm' }, descriptionText: '', hasToggle: true },
                corePce: { name: 'Core PCE', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'lin', frequency: 'm' }, descriptionText: '', hasToggle: true },
                fedtarget: { name: 'Fed Target', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'dd/mm', apiParams: { units: 'lin' }, hasToggle: true },
                fedfunds: { name: 'Fed Funds Rate', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'dd/mm', apiParams: { units: 'lin' }, descriptionText: '' },
                inflationExp: { name: 'Expectativa Inflação 5A', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'dd/mm', apiParams: { units: 'lin' }, descriptionText: '5 Anos (Breakeven)' },
                yieldCurve: { name: 'Curva de Juros 10A-2A', unit: 'p.p.', unitPos: 'after', chartUnit: 'p.p.', dateFormat: 'dd/mm', apiParams: { units: 'lin' }, descriptionText: 'Spread 10Y-2Y (p.p.)' },
                gdpReal: { name: 'PIB Real (Variação Anual)', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'pc1', frequency: 'a' }, descriptionText: 'Variação Anual' },
                gdpNominal: { name: 'PIB Nominal (Trimestral)', unit: ' trilhões USD', unitPos: 'after', chartUnit: '$', dateFormat: 'mm/yyyy', apiParams: { units: 'lin', frequency: 'q' }, specialProcessing: (val) => (parseFloat(val) / 1000).toFixed(2), descriptionText: 'Total em Dólares' },
                unemployment: { name: 'Desemprego (EUA)', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'lin' }, descriptionText: '' },
                payrolls: { name: 'Nonfarm Payrolls', unit: 'K', unitPos: 'after', chartUnit: 'K', dateFormat: 'mm/yyyy', apiParams: { units: 'chg', frequency: 'm' }, specialProcessing: (val) => parseFloat(val).toFixed(0), descriptionText: 'Criação de Vagas' },
                indpro: { name: 'Produção Industrial', unit: '%', unitPos: 'after', chartUnit: '%', dateFormat: 'mm/yyyy', apiParams: { units: 'pc1', frequency: 'm' }, descriptionText: 'Variação Anual' },
                sentiment: { name: 'Confiança do Consumidor', unit: '', unitPos: 'after', chartUnit: '', dateFormat: 'mm/yyyy', apiParams: {}, descriptionText: 'Índice (U. Michigan)' },
                treasury: { name: 'Treasury Yield', chartUnit: '%', dateFormat: 'dd/mm' }
            }
        };

        // --- 2. API SERVICE ---
        const apiService = {
            async getBCBData(seriesId, days = 1) { const url = `${config.apiBaseUrl}${seriesId}/dados/ultimos/${days}?formato=json`; try { const response = await fetch(url); if (!response.ok) throw new Error(`BCB API Error for series ${seriesId}: ${response.statusText}`); return await response.json(); } catch (error) { console.error(error.message); throw error; } },
            async getBCBDataByDateRange(seriesId, days) { const endDate = new Date(); const startDate = new Date(); startDate.setDate(endDate.getDate() - days); const formatDate = (date) => `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`; const url = `https://api.bcb.gov.br/dados/serie/bcdata.sgs.${seriesId}/dados?formato=json&dataInicial=${formatDate(startDate)}&dataFinal=${formatDate(endDate)}`; try { const response = await fetch(url); if (!response.ok) throw new Error(`BCB API Error for series ${seriesId}: ${response.statusText}`); return await response.json(); } catch (error) { console.error(error.message); throw error; } },
            async getBCBDataByYearRange(seriesId, years) { const endDate = new Date(); const startDate = new Date(); startDate.setFullYear(endDate.getFullYear() - years); const formatDate = (date) => `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`; const url = `https://api.bcb.gov.br/dados/serie/bcdata.sgs.${seriesId}/dados?formato=json&dataInicial=${formatDate(startDate)}&dataFinal=${formatDate(endDate)}`; try { const response = await fetch(url); if (!response.ok) throw new Error(`BCB API Error for series ${seriesId}: ${response.statusText}`); return await response.json(); } catch (error) { console.error(error.message); throw error; } },
            async getCDSData() { try { const response = await fetch(config.cdsApiUrl); if (!response.ok) throw new Error(`CDS API Error: ${response.statusText}`); const htmlContent = await response.text(); const parser = new DOMParser(); const doc = parser.parseFromString(htmlContent, 'text/html'); const cdsValueElement = doc.querySelector('[data-test="instrument-price-last"]'); if (!cdsValueElement) throw new Error('Elemento do valor do CDS não encontrado.'); return parseFloat(cdsValueElement.textContent.replace(',', '.')).toFixed(2); } catch (error) { console.error("Erro ao buscar CDS:", error.message); throw error; } },
            async getTesouroDiretoData() { try { const response = await fetch(config.tesouroApiUrl); if (!response.ok) throw new Error(`Tesouro Direto API Error: ${response.statusText}`); const data = await response.json(); return data.response; } catch (error) { console.error("Erro ao buscar dados do Tesouro Direto:", error.message); throw error; } },
            async getFREDData(seriesId, options = {}, limit = 1000, sort_order = 'desc') { const { units = 'lin', frequency = null, aggregation_method = 'avg' } = options; let fredUrl = `${config.fredApiBaseUrl}?series_id=${seriesId}&api_key=${config.fredApiKey}&file_type=json&limit=${limit}&sort_order=${sort_order}`; if (units) fredUrl += `&units=${units}`; if (frequency) fredUrl += `&frequency=${frequency}`; if (aggregation_method) fredUrl += `&aggregation_method=${aggregation_method}`; const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(fredUrl); try { const response = await fetch(proxyUrl); if (!response.ok) throw new Error(`FRED API Error for series ${seriesId} via proxy: ${response.status}`); const data = await response.json(); if (data.error_message) throw new Error(`FRED API Error for series ${seriesId}: ${data.error_message}`); return data.observations.filter(obs => obs.value !== '.').map(obs => { const parts = obs.date.split('-'); const date = new Date(parts[0], parts[1] - 1, parts[2]); return { date: date, valor: parseFloat(obs.value) }; }).reverse(); } catch (error) { console.error(`Failed to fetch ${seriesId}:`, error); throw error; } }
        };

        // --- 3. UI CONTROLLER ---
        const uiController = {
            updateText(selector, text, options = {}) { const { unit = '', unitPosition = 'before', isDate = false, data = 'N/D' } = options; const element = document.querySelector(selector); if (element) { if (text === config.errorText) { element.textContent = config.errorTextFriendly; return; } if (isDate) { element.textContent = data; return; } const value = text ?? config.errorTextFriendly; const formattedText = String(value).replace('.', ','); if(unitPosition === 'after') { element.textContent = `${formattedText}${unit}`; } else { element.textContent = `${unit}${formattedText}`; } } },
            updateDateTime(source = 'BCB, Investing.com') { const now = new Date(); const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }; this.updateText(config.selectors.updateTime, ``, { isDate: true, data: `Atualizado em ${now.toLocaleDateString('pt-BR', options)}` }); document.querySelector(config.selectors.footer).textContent = `Fontes: ${source}, Tesouro Direto • © ${new Date().getFullYear()} Mercado Macro`; },
            setLoadingState(isLoading) { if (isLoading) { this.updateText(config.selectors.updateTime, ``, { isDate: true, data: 'Atualizando dados...' }); } },
            showToast(message, type = 'success', duration = 3000) { const container = document.getElementById('toast-container'); const toast = document.createElement('div'); toast.className = `toast ${type}`; toast.textContent = message; container.appendChild(toast); setTimeout(() => { toast.classList.add('fade-out'); toast.addEventListener('animationend', () => toast.remove()); }, duration); },
            createSparklineChart(selector, seriesData, name = 'Valor', tooltipUnit = '%', dateFormat = 'mm/yyyy', customOptions = {}) {
                const container = document.querySelector(selector);
                if (container) container.innerHTML = '';
                if (!seriesData || seriesData.length === 0) { if (container) container.textContent = "Dados insuficientes para gerar gráfico."; return null; }
                const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();
                const defaultOptions = {
                    chart: { type: 'area', height: 80, sparkline: { enabled: true }, animations: { enabled: true, speed: 800 }},
                    stroke: { curve: 'smooth', width: 2 },
                    fill: { opacity: 0.3 },
                    colors: [primaryColor],
                    series: [{ name: name, data: seriesData.map(item => ({ x: item.date.getTime(), y: item.valor })) }],
                    tooltip: { theme: document.body.classList.contains('light-mode') ? 'light' : 'dark', style: { fontSize: '12px', fontFamily: 'Montserrat' }, x: { formatter: (val, opts) => { if (!seriesData[opts.dataPointIndex]) return ''; const date = seriesData[opts.dataPointIndex].date; const day = String(date.getDate()).padStart(2, '0'); const month = String(date.getMonth() + 1).padStart(2, '0'); const year = date.getFullYear(); if (dateFormat === 'yyyy') return year; if (dateFormat === 'dd/mm') return `${day}/${month}`; return `${month}/${year}`; } }, y: { formatter: (value) => { const formattedValue = value ? value.toFixed(2).replace('.', ',') : '0,00'; const unitSymbol = (tooltipUnit === '$' || tooltipUnit === 'R$') ? tooltipUnit : ''; const unitText = (tooltipUnit === '$' || tooltipUnit === 'R$') ? '' : ` ${tooltipUnit}`; return `${unitSymbol}${formattedValue}${unitText}`; }, title: { formatter: (seriesName) => seriesName || '' } }, marker: { show: false } }
                };
                const finalOptions = { ...defaultOptions, ...customOptions, annotations: { ...defaultOptions.annotations, ...customOptions.annotations }, chart: { ...defaultOptions.chart, ...customOptions.chart }, tooltip: { ...defaultOptions.tooltip, ...customOptions.tooltip } };
                if (container) { const chart = new ApexCharts(container, finalOptions); chart.render(); return chart; } return null;
            }
        };
        
        // --- 4. MAIN APPLICATION ---
        const app = {
            nationalData: {},
            internationalData: { series: {}, charts: {}, activeTreasuryYield: '10Y' },
            isInternationalView: false,

            markCardAsLoaded(cardId) { const card = document.querySelector(`[data-id="${cardId}"]`); if (card) { card.classList.add('card-loaded'); } },

            async fetchAllNationalIndicators() {
                const cachedData = cacheService.get('allNationalIndicators');
                if (cachedData) { this.processNationalResults(cachedData); uiController.updateText(config.selectors.updateTime, '', { isDate: true, data: 'Exibindo dados do cache...' }); } 
                else { uiController.setLoadingState(true); }
                const { apiCodes } = config;
                const promises = {
                    cds: apiService.getCDSData(), tesouro: apiService.getTesouroDiretoData(), dolarBuy: apiService.getBCBData(apiCodes.dolarBuy, 1),
                    dolarSell: apiService.getBCBDataByDateRange(apiCodes.dolarSell, 365), euroBuy: apiService.getBCBData(apiCodes.euroBuy, 1),
                    euroSell: apiService.getBCBDataByDateRange(apiCodes.euroSell, 365), cdi: apiService.getBCBDataByDateRange(apiCodes.cdi, 365),
                    selicMeta: apiService.getBCBDataByDateRange(apiCodes.selicMeta, 365), ipca: apiService.getBCBData(apiCodes.ipca, 12),
                    ipca15: apiService.getBCBData(apiCodes.ipca15, 12), inpc: apiService.getBCBData(apiCodes.inpc, 12),
                    igpm: apiService.getBCBData(apiCodes.igpm, 12), igpdi: apiService.getBCBData(apiCodes.igpdi, 12),
                    pibBr: apiService.getBCBDataByYearRange(apiCodes.pibBr, 50), poupanca: apiService.getBCBData(apiCodes.poupanca, 12),
                    desemprego: apiService.getBCBData(apiCodes.desemprego, 12)
                };
                const results = await Promise.allSettled(Object.values(promises));
                const data = Object.keys(promises).reduce((acc, key, index) => { acc[key] = results[index]; return acc; }, {});
                this.nationalData = data; this.processNationalResults(data); cacheService.set('allNationalIndicators', data);
                if (!this.isInternationalView) { uiController.updateDateTime('BCB, Investing.com'); }
            },

            processNationalResults(data) {
                const { selectors, errorText } = config;
                this.nationalData = data;
                
                uiController.updateText(selectors.riskValue, data.cds.status === 'fulfilled' ? data.cds.value : errorText);
                this.processCDSChart(); this.markCardAsLoaded('risk');

                this.processTesouroDireto(data.tesouro);

                uiController.updateText(selectors.dolarBuy, data.dolarBuy.status === 'fulfilled' ? parseFloat(data.dolarBuy.value?.[0]?.valor).toFixed(2) : errorText, {unit:'R$ '});
                uiController.updateText(selectors.dolarSell, data.dolarSell.status === 'fulfilled' && data.dolarSell.value.length > 0 ? parseFloat(data.dolarSell.value?.[data.dolarSell.value.length - 1]?.valor).toFixed(2) : errorText, {unit:'R$ '});
                this.markCardAsLoaded('dolar');
                
                uiController.updateText(selectors.euroBuy, data.euroBuy.status === 'fulfilled' ? parseFloat(data.euroBuy.value?.[0]?.valor).toFixed(2) : errorText, {unit:'R$ '});
                uiController.updateText(selectors.euroSell, data.euroSell.status === 'fulfilled' && data.euroSell.value.length > 0 ? parseFloat(data.euroSell.value?.[data.euroSell.value.length - 1]?.valor).toFixed(2) : errorText, {unit:'R$ '});
                this.markCardAsLoaded('euro');

                this.processCurrency(data.dolarSell, '#dolar-chart-container', 'Dólar Venda');
                this.processCurrency(data.euroSell, '#euro-chart-container', 'Euro Venda');
                this.processCDI(data.cdi); this.markCardAsLoaded('cdi');
                this.processSelic(data.selicMeta); this.markCardAsLoaded('selic');
                this.processInflationIndex(data.ipca, selectors.ipcaMonth, selectors.ipca12m, '#ipca-chart-container', 'IPCA Mensal'); this.markCardAsLoaded('ipca');
                this.processInflationIndex(data.ipca15, selectors.ipca15Month, selectors.ipca1512m, '#ipca15-chart-container', 'IPCA-15 Mensal'); this.markCardAsLoaded('ipca15');
                this.processInflationIndex(data.inpc, selectors.inpcMonth, selectors.inpc12m, '#inpc-chart-container', 'INPC Mensal'); this.markCardAsLoaded('inpc');
                this.processInflationIndex(data.igpm, selectors.igpmMonth, selectors.igpm12m, '#igpm-chart-container', 'IGP-M Mensal'); this.markCardAsLoaded('igpm');
                this.processInflationIndex(data.igpdi, selectors.igpdiMonth, selectors.igpdi12m, '#igpdi-chart-container', 'IGP-DI Mensal'); this.markCardAsLoaded('igpdi');
                this.processPibBr(data.pibBr); this.markCardAsLoaded('pib-br');
                this.processPoupanca(data.poupanca); this.markCardAsLoaded('poupanca');
                this.processUnemployment(data.desemprego); this.markCardAsLoaded('desemprego');
            },
            
            processCDSChart() { const cdsHistoryData = [ { date: new Date('2017-01-01'), valor: 160.50 }, { date: new Date('2018-01-01'), valor: 207.70 }, { date: new Date('2019-01-01'), valor: 99.10 },  { date: new Date('2020-01-01'), valor: 142.30 }, { date: new Date('2021-01-01'), valor: 203.10 }, { date: new Date('2022-01-01'), valor: 250.26 }, { date: new Date('2023-01-01'), valor: 132.49 }, { date: new Date('2024-01-01'), valor: 205.02 }, { date: new Date('2025-01-01'), valor: 156.55 } ]; uiController.createSparklineChart('#risk-chart-container', cdsHistoryData, 'CDS Anual', ' pts', 'yyyy'); },
            
            processTesouroDireto(promiseResult) {
                const { selectors, errorTextFriendly } = config;
                const selectorEl = document.querySelector(selectors.tesouroSelector);
                const rateEl = document.querySelector(selectors.tesouroRate);
                const priceEl = document.querySelector(selectors.tesouroPrice);
                const statusEl = document.querySelector(selectors.tesouroMarketStatus); 
                const timesEl = document.querySelector(selectors.tesouroMarketTimes);   
                const quoteTimeEl = document.querySelector(selectors.tesouroQuoteTime);    
                if (!selectorEl || !rateEl || !priceEl || !statusEl || !timesEl || !quoteTimeEl) return;

                if (promiseResult.status === 'fulfilled' && promiseResult.value) {
                    const fullResponse = promiseResult.value;
                    const bonds = fullResponse.TrsrBdTradgList ? fullResponse.TrsrBdTradgList.filter(item => item.TrsrBd.anulInvstmtRate > 0 && item.TrsrBd.untrInvstmtVal > 0) : [];
                    const marketInfo = fullResponse.TrsrBondMkt;
                    
                    if (marketInfo) { statusEl.textContent = `Status: ${marketInfo.sts}`; const openTime = new Date(marketInfo.opngDtTm).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }); const closeTime = new Date(marketInfo.clsgDtTm).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }); timesEl.textContent = `Aberto: ${openTime} | Fechado: ${closeTime}`; const quoteTime = new Date(marketInfo.qtnDtTm).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' }); quoteTimeEl.textContent = `Cotação: ${quoteTime}`; } 
                    else { statusEl.textContent = 'Status: N/D'; timesEl.textContent = 'Horários: N/D'; quoteTimeEl.textContent = 'Cotação: N/D'; }

                    const groupedBonds = bonds.reduce((acc, bondData) => {
                        const name = bondData.TrsrBd.nm;
                        let groupName = 'Outros';
                        if (name.includes('Selic')) groupName = 'Tesouro Selic';
                        else if (name.includes('IPCA')) groupName = 'Tesouro IPCA+';
                        else if (name.includes('Prefixado')) groupName = 'Tesouro Prefixado';
                        else if (name.includes('Renda')) groupName = 'Tesouro Renda+';
                        if (!acc[groupName]) { acc[groupName] = []; } acc[groupName].push(bondData); return acc;
                    }, {});

                    selectorEl.innerHTML = '';
                    if (Object.keys(groupedBonds).length > 0) {
                        for (const groupName in groupedBonds) {
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = groupName;
                            groupedBonds[groupName].forEach(bondData => {
                                const option = document.createElement('option');
                                option.value = bonds.indexOf(bondData);
                                option.textContent = bondData.TrsrBd.nm;
                                optgroup.appendChild(option);
                            });
                            selectorEl.appendChild(optgroup);
                        }
                        
                        const newSelectorEl = selectorEl.cloneNode(true);
                        selectorEl.parentNode.replaceChild(newSelectorEl, selectorEl);
                        newSelectorEl.addEventListener('change', (e) => { const selectedBond = bonds[e.target.value]; updateTesouroCard(selectedBond); });
                        updateTesouroCard(bonds[0]); newSelectorEl.value = "0"; 
                    } else { selectorEl.innerHTML = '<option>Nenhum título disponível</option>'; rateEl.textContent = errorTextFriendly; priceEl.textContent = errorTextFriendly; }
                } else { selectorEl.innerHTML = '<option>Erro ao carregar</option>'; rateEl.textContent = errorTextFriendly; priceEl.textContent = errorTextFriendly; statusEl.textContent = `Status: ${errorTextFriendly}`; timesEl.textContent = `Horários: ${errorTextFriendly}`; quoteTimeEl.textContent = `Cotação: ${errorTextFriendly}`; }
                this.markCardAsLoaded('tesouro');

                function updateTesouroCard(bond) { const bondName = bond.TrsrBd.nm; const rate = bond.TrsrBd.anulInvstmtRate; const price = bond.TrsrBd.untrInvstmtVal; let formattedRate = ''; if (bondName.includes('Selic')) { const decimalRate = rate.toFixed(4).replace('.', ','); formattedRate = `Selic + ${decimalRate}%`; } else if (bondName.includes('IPCA')) { const percentageRate = rate.toFixed(2).replace('.', ','); formattedRate = `IPCA + ${percentageRate}%`; } else { const percentageRate = rate.toFixed(2).replace('.', ','); formattedRate = `${percentageRate}%`; } rateEl.textContent = formattedRate; priceEl.textContent = `R$ ${price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`; };
            },
            
            processInflationIndex(promiseResult, monthElem, yearElem, chartSelector, chartName) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})); uiController.updateText(monthElem, `${parseFloat(data[data.length - 1].valor).toFixed(2)}%`); const yearValue = data.slice(-12).reduce((acc, item) => acc * (1 + parseFloat(item.valor) / 100), 1); uiController.updateText(yearElem, `${((yearValue - 1) * 100).toFixed(2)} %`); uiController.createSparklineChart(chartSelector, data, chartName, '%', 'mm/yyyy'); } else { uiController.updateText(monthElem, config.errorText); uiController.updateText(yearElem, config.errorText); } },
            processPibBr(promiseResult) { const pibValueElement = document.querySelector('#pib-br-value'); try { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({ ...item, date: new Date(item.data.split('/')[2], 0, 1) })); const latestDataPoint = data[data.length - 1]; if (!latestDataPoint || typeof latestDataPoint.valor === 'undefined') { throw new Error("Ponto de dado do PIB é inválido."); } const lastValueInMillions = parseFloat(latestDataPoint.valor); if (isNaN(lastValueInMillions)) { throw new Error(`Valor do PIB não é um número: ${latestDataPoint.valor}`); } const valueInTrillions = (lastValueInMillions / 1000000000000); const formattedValue = valueInTrillions.toFixed(2).replace('.', ','); const finalPibString = `R$ ${formattedValue} tri`; if (pibValueElement) { pibValueElement.textContent = finalPibString; } const chartData = data.map(item => ({ date: item.date, valor: parseFloat(item.valor) / 1000000000000 })); uiController.createSparklineChart('#pib-br-chart-container', chartData, 'PIB (R$ tri)', 'tri', 'yyyy'); } else { throw new Error("Requisição do PIB falhou ou retornou vazia."); } } catch (error) { console.error("Erro ao processar PIB:", error); if (pibValueElement) { pibValueElement.textContent = config.errorTextFriendly; } } },
            processUnemployment(promiseResult) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})); const lastValue = parseFloat(data[data.length - 1].valor).toFixed(2); uiController.updateText(config.selectors.desemprego, `${lastValue}%`); uiController.createSparklineChart('#desemprego-chart-container', data, 'Taxa de Desocupação', '%', 'mm/yyyy'); } else { uiController.updateText(config.selectors.desemprego, config.errorText); } },
            processCurrency(promiseResult, chartSelector, chartName) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})); uiController.createSparklineChart(chartSelector, data, chartName, 'R$', 'dd/mm'); } },
            processCDI(promiseResult) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value; const lastDailyRate = parseFloat(data[data.length - 1].valor); const lastAnnualRate = (Math.pow(1 + (lastDailyRate / 100), 252) - 1) * 100; uiController.updateText(config.selectors.cdiAnnual, `${lastAnnualRate.toFixed(2)}% a.a.`); const annualizedHistory = data.map(item => ({ date: new Date(item.data.split('/').reverse().join('-')), valor: ((Math.pow(1 + (parseFloat(item.valor) / 100), 252) - 1) * 100) })); uiController.createSparklineChart('#cdi-chart-container', annualizedHistory, 'CDI Anualizado', '%', 'dd/mm'); } else { uiController.updateText(config.selectors.cdiAnnual, config.errorText); } },
            processSelic(promiseResult) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})); uiController.updateText(config.selectors.selicMeta, `${parseFloat(data[data.length - 1].valor).toFixed(2)}% a.a.`); uiController.createSparklineChart('#selic-chart-container', data, 'Meta Selic', '%', 'dd/mm'); } else { uiController.updateText(config.selectors.selicMeta, config.errorText); } },
            processPoupanca(promiseResult) { if (promiseResult.status === 'fulfilled' && promiseResult.value?.length > 0) { const data = promiseResult.value.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})); const lastMonthRate = parseFloat(data[data.length - 1].valor); uiController.updateText(config.selectors.poupancaMonth, `${lastMonthRate.toFixed(2)}%`); const annualizedRate = (Math.pow(1 + (lastMonthRate / 100), 12) - 1) * 100; uiController.updateText(config.selectors.poupancaAnnualized, `${annualizedRate.toFixed(2)}%`); uiController.createSparklineChart('#poupanca-chart-container', data, 'Poupança Mensal', '%', 'mm/yyyy'); } else { uiController.updateText(config.selectors.poupancaMonth, config.errorText); uiController.updateText(config.selectors.poupancaAnnualized, config.errorText); } },
            
            updateNationalChartForPeriod(indicatorId, period) {
                const rawData = this.nationalData[indicatorId]?.value;
                if (!rawData) return;
                let fullHistory;
                if (indicatorId === 'pibBr') { fullHistory = rawData.map(d => ({...d, date: new Date(d.data.split('/')[2], 0, 1)})); } 
                else { fullHistory = rawData.map(item => ({...item, date: new Date(item.data.split('/').reverse().join('-'))})) }
                let filteredData;
                if (period === 'max' || period === 50) { filteredData = fullHistory; } 
                else {
                    const cutoffDate = new Date();
                    if (indicatorId === 'pibBr') { cutoffDate.setFullYear(cutoffDate.getFullYear() - period); }
                    else if (['ipca', 'ipca15', 'inpc', 'igpm', 'igpdi', 'poupanca', 'desemprego'].includes(indicatorId)) { cutoffDate.setMonth(cutoffDate.getMonth() - period); }
                    else { cutoffDate.setDate(cutoffDate.getDate() - period); }
                    filteredData = fullHistory.filter(item => item.date >= cutoffDate);
                }
                const chartSelector = `#${indicatorId.replace('Meta','').replace('Sell','').replace('Br', '-br')}-chart-container`;
                switch(indicatorId) {
                    case 'dolarSell': uiController.createSparklineChart(chartSelector, filteredData, 'Dólar Venda', 'R$', 'dd/mm'); break;
                    case 'euroSell': uiController.createSparklineChart(chartSelector, filteredData, 'Euro Venda', 'R$', 'dd/mm'); break;
                    case 'cdi': 
                        const annualizedHistory = filteredData.map(item => ({ date: item.date, valor: ((Math.pow(1 + (parseFloat(item.valor) / 100), 252) - 1) * 100) }));
                        uiController.createSparklineChart(chartSelector, annualizedHistory, 'CDI Anualizado', '%', 'dd/mm');
                        break;
                    case 'selicMeta': uiController.createSparklineChart(chartSelector, filteredData, 'Meta Selic', '%', 'dd/mm'); break;
                    case 'pibBr':
                        const pibChartData = filteredData.map(item => ({ date: item.date, valor: parseFloat(item.valor) / 1000000000000 }));
                        uiController.createSparklineChart(chartSelector, pibChartData, 'PIB (R$ tri)', 'tri', 'yyyy');
                        break;
                    case 'ipca': case 'ipca15': case 'inpc': case 'igpm': case 'igpdi': case 'poupanca': case 'desemprego':
                        const names = {ipca: 'IPCA Mensal', ipca15: 'IPCA-15 Mensal', inpc: 'INPC Mensal', igpm: 'IGP-M Mensal', igpdi: 'IGP-DI Mensal', poupanca: 'Poupança Mensal', desemprego: 'Taxa de Desocupação'};
                        uiController.createSparklineChart(chartSelector, filteredData, names[indicatorId], '%', 'mm/yyyy'); break;
                }
            },
            
            async fetchAllInternationalIndicators() {
                const cacheKey = 'allInternationalIndicators_v6_treasury';
                const cachedData = cacheService.get(cacheKey);
                if (cachedData) { this.internationalData.series = Object.entries(cachedData).reduce((acc, [key, value]) => { if (value?.raw) { acc[key] = { raw: value.raw.map(item => ({...item, date: new Date(item.date)})), yoy: value.yoy.map(item => ({...item, date: new Date(item.date)})), mom: value.mom.map(item => ({...item, date: new Date(item.date)})) }; } else if(value) { acc[key] = value.map(item => ({...item, date: new Date(item.date)})); } return acc; }, {}); this.processInternationalResults(); uiController.updateText(config.selectors.updateTime, '', {isDate: true, data: 'Exibindo dados do cache...'}); return; }
                uiController.setLoadingState(true); const { fredApiCodes, fredIndicatorsConfig } = config; const promises = {};
                for (const key in fredIndicatorsConfig) { if (key === 'treasury' || key === 'fedtarget') continue; promises[key] = apiService.getFREDData(fredApiCodes[key], fredIndicatorsConfig[key].apiParams, 1000); }
                promises.fedTargetUpper = apiService.getFREDData(fredApiCodes.fedTargetUpper, {}, 1000); promises.fedTargetLower = apiService.getFREDData(fredApiCodes.fedTargetLower, {}, 1000);
                promises.treasury2Y = apiService.getFREDData(fredApiCodes.treasury2Y, {}); promises.treasury10Y = apiService.getFREDData(fredApiCodes.treasury10Y, {}); promises.treasury30Y = apiService.getFREDData(fredApiCodes.treasury30Y, {});
                const results = await Promise.allSettled(Object.values(promises)); let data = Object.keys(promises).reduce((acc, key, index) => { if (results[index].status === 'fulfilled') { acc[key] = results[index].value; } else { acc[key] = null; } return acc; }, {});
                for (const key in data) { const cfg = fredIndicatorsConfig[key]; if (cfg && cfg.hasToggle && data[key] && key !== 'fedtarget') { const variations = this.calculateVariations(data[key]); data[key] = { raw: data[key], ...variations }; } }
                this.internationalData.series = data; this.processInternationalResults(); cacheService.set(cacheKey, data); if (this.isInternationalView) { uiController.updateDateTime('FRED St. Louis Fed'); }
            },

            processInternationalResults() {
                const { fredIndicatorsConfig, errorText } = config;
                for (const key in fredIndicatorsConfig) {
                    const cardId = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                    if (key === 'treasury' || key === 'fedtarget') continue;
                    
                    const cfg = fredIndicatorsConfig[key]; const seriesData = this.internationalData.series[key]; const valueSelector = `#${cardId}-value`; const dateSelector = `#${cardId}-date`;
                    if (cfg.hasToggle) { this.updateCpiCardView(key); } 
                    else if (seriesData && seriesData.length > 0) { const latestValue = seriesData[seriesData.length - 1]; let displayValue = latestValue.valor; if (cfg.specialProcessing) displayValue = cfg.specialProcessing(latestValue.valor); uiController.updateText(valueSelector, displayValue.toString(), { unit: cfg.unit, unitPosition: cfg.unitPos }); const dateElement = document.querySelector(dateSelector); if(dateElement) { const date = latestValue.date; const dateFormatOptions = { year: 'numeric' }; if (cfg.dateFormat.includes('mm')) dateFormatOptions.month = '2-digit'; if (cfg.dateFormat.includes('dd')) dateFormatOptions.day = '2-digit'; const dateString = date.toLocaleDateString('pt-BR', dateFormatOptions); const finalDateText = cfg.descriptionText ? `${cfg.descriptionText} (${dateString})` : dateString; uiController.updateText(dateSelector, '', { isDate: true, data: finalDateText }); } this.updateInternationalChartForPeriod(key, 5, 'years'); } 
                    else { uiController.updateText(valueSelector, errorText); const dateElement = document.querySelector(dateSelector); if(dateElement) uiController.updateText(dateSelector, '', { isDate: true, data: 'N/D' }); }
                    this.markCardAsLoaded(cardId);
                }
                this.updateFedTargetView();
                this.updateTreasuryView(this.internationalData.activeTreasuryYield);
            },
            
            calculateVariations(rawData) {
                const dataYoY = [];
                const dataMoM = [];
                if (!rawData) return { yoy: dataYoY, mom: dataMoM };
                for (let i = 0; i < rawData.length; i++) {
                    const current = rawData[i];
                    if (i > 0) {
                        const previous = rawData[i-1];
                        const momValue = ((current.valor / previous.valor) - 1) * 100;
                        dataMoM.push({ date: current.date, valor: momValue });
                    }
                    if (i >= 12) {
                        const previousYear = rawData[i-12];
                        const yoyValue = ((current.valor / previousYear.valor) - 1) * 100;
                        dataYoY.push({ date: current.date, valor: yoyValue });
                    }
                }
                return { yoy: dataYoY, mom: dataMoM };
            },

            updateInternationalChartForPeriod(indicatorId, periodValue, periodUnit) {
                let cfg, fullHistory, chartSelector;
                if (indicatorId === 'treasury') { cfg = config.fredIndicatorsConfig.treasury; const activeYieldKey = 'treasury' + this.internationalData.activeTreasuryYield; fullHistory = this.internationalData.series[activeYieldKey]; chartSelector = '#treasury-chart';
                } else {
                    cfg = config.fredIndicatorsConfig[indicatorId];
                    if (cfg.hasToggle) { if (indicatorId === 'fedtarget') { const isPiso = document.getElementById('fedtarget-toggle-switch').checked; const seriesKey = isPiso ? 'fedTargetLower' : 'fedTargetUpper'; fullHistory = this.internationalData.series[seriesKey]; cfg.chartUnit = '%'; cfg.name = isPiso ? 'Fed Target (Piso)' : 'Fed Target (Teto)'; } else { const cardIdPrefix = indicatorId.replace(/([A-Z])/g, '-$1').toLowerCase(); const isMonthly = document.getElementById(`${cardIdPrefix}-toggle-switch`).checked; fullHistory = isMonthly ? this.internationalData.series[indicatorId]?.mom : this.internationalData.series[indicatorId]?.yoy; cfg.chartUnit = '%'; }
                    } else { fullHistory = this.internationalData.series[indicatorId]; }
                    chartSelector = `#${indicatorId.replace(/([A-Z])/g, '-$1').toLowerCase()}-chart`;
                }
                if (!fullHistory) return; let filteredData;
                if (periodUnit === 'max' || periodValue === 'max') { filteredData = fullHistory; } else { const cutoffDate = new Date(); cutoffDate.setFullYear(cutoffDate.getFullYear() - periodValue); filteredData = fullHistory.filter(item => item.date >= cutoffDate); }
                if(this.internationalData.charts[indicatorId]) { this.internationalData.charts[indicatorId].destroy(); }
                
                let customOptions = {};
                if (indicatorId === 'yieldCurve') { customOptions = { annotations: { yaxis: [{ y: 0, borderColor: 'var(--down-trend)', strokeDashArray: 4, label: { borderColor: 'var(--down-trend)', style: { color: '#fff', background: 'var(--down-trend)', fontSize: '10px', padding: { left: 4, right: 4, top: 1, bottom: 2 } }, text: 'Inversão' } }] } }; }
                
                const chartInstance = uiController.createSparklineChart( chartSelector, filteredData, cfg.name, cfg.chartUnit, cfg.dateFormat, customOptions );
                if (chartInstance) { this.internationalData.charts[indicatorId] = chartInstance; }
            },
            updateCpiCardView(indicatorId) {
                const seriesData = this.internationalData.series[indicatorId]; if (!seriesData || !seriesData.yoy || !seriesData.mom || !seriesData.raw) return;
                const cardIdPrefix = indicatorId.replace(/([A-Z])/g, '-$1').toLowerCase(); const isMonthly = document.getElementById(`${cardIdPrefix}-toggle-switch`).checked;
                let dataToShow, descriptionText, valueUnit;
                if (isMonthly) { dataToShow = seriesData.mom; descriptionText = "Variação Mensal"; valueUnit = '%'; } else { dataToShow = seriesData.yoy; descriptionText = "Variação Anual"; valueUnit = '%'; }
                const cardElement = document.querySelector(`[data-id="${cardIdPrefix}"]`); if (cardElement) { cardElement.querySelector('.card-switch-label[data-type="anual"]').classList.toggle('active', !isMonthly); cardElement.querySelector('.card-switch-label[data-type="mensal"]').classList.toggle('active', isMonthly); }
                if (dataToShow.length > 0) { const latestValue = dataToShow[dataToShow.length - 1]; uiController.updateText(`#${cardIdPrefix}-value`, latestValue.valor.toFixed(2), { unit: valueUnit, unitPosition: 'after' }); const dateString = latestValue.date.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' }); uiController.updateText(`#${cardIdPrefix}-date`, '', { isDate: true, data: `${descriptionText} (${dateString})` }); } else { uiController.updateText(`#${cardIdPrefix}-value`, config.errorText); uiController.updateText(`#${cardIdPrefix}-date`, '', { isDate: true, data: 'N/D' }); }
                const defaultPeriodBtn = document.querySelector(`.chart-controls[data-indicator-id="${indicatorId}"] .chart-period-btn.active`); const defaultYears = defaultPeriodBtn ? (defaultPeriodBtn.dataset.years === 'max' ? 'max' : parseInt(defaultPeriodBtn.dataset.years, 10)) : 5; const defaultUnit = defaultYears === 'max' ? 'max' : 'years'; this.updateInternationalChartForPeriod(indicatorId, defaultYears, defaultUnit);
            },
            updateFedTargetView() {
                const isPiso = document.getElementById('fedtarget-toggle-switch').checked; const seriesKey = isPiso ? 'fedTargetLower' : 'fedTargetUpper'; const seriesData = this.internationalData.series[seriesKey];
                const cardElement = document.querySelector('[data-id="fedtarget"]'); if (cardElement) { cardElement.querySelector('.card-switch-label[data-type="teto"]').classList.toggle('active', !isPiso); cardElement.querySelector('.card-switch-label[data-type="piso"]').classList.toggle('active', isPiso); }
                if (seriesData && seriesData.length > 0) { const latestValue = seriesData[seriesData.length - 1]; const descriptionText = isPiso ? "Piso da Meta" : "Teto da Meta"; uiController.updateText('#fedtarget-value', latestValue.valor.toFixed(2), { unit: '%', unitPosition: 'after' }); const dateString = latestValue.date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }); uiController.updateText('#fedtarget-date', '', { isDate: true, data: `${descriptionText} (${dateString})` }); } 
                else { uiController.updateText('#fedtarget-value', config.errorText); uiController.updateText('#fedtarget-date', '', { isDate: true, data: 'N/D' }); }
                const defaultPeriodBtn = document.querySelector('.chart-controls[data-indicator-id="fedtarget"] .chart-period-btn.active'); const defaultYears = defaultPeriodBtn ? (defaultPeriodBtn.dataset.years === 'max' ? 'max' : parseInt(defaultPeriodBtn.dataset.years, 10)) : 5; const defaultUnit = defaultYears === 'max' ? 'max' : 'years'; this.updateInternationalChartForPeriod('fedtarget', defaultYears, defaultUnit);
                this.markCardAsLoaded('fedtarget');
            },
            updateTreasuryView(yieldType) { 
                this.internationalData.activeTreasuryYield = yieldType; const activeYieldKey = 'treasury' + yieldType; const seriesData = this.internationalData.series[activeYieldKey];
                if (seriesData && seriesData.length > 0) { const latestValue = seriesData[seriesData.length - 1]; uiController.updateText('#treasury-value', latestValue.valor.toFixed(2), { unit: '%', unitPosition: 'after' }); const dateString = latestValue.date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }); uiController.updateText('#treasury-date', '', { isDate: true, data: dateString }); } 
                else { uiController.updateText('#treasury-value', config.errorText); uiController.updateText('#treasury-date', '', { isDate: true, data: 'N/D' }); }
                document.querySelectorAll('.yield-btn').forEach(btn => { btn.classList.toggle('active', btn.dataset.yield === yieldType); });
                const activePeriodBtn = document.querySelector('.chart-controls[data-indicator-id="treasury"] .chart-period-btn.active'); const periodValue = activePeriodBtn.dataset.years === 'max' ? 'max' : parseInt(activePeriodBtn.dataset.years, 10); const periodUnit = activePeriodBtn.dataset.years === 'max' ? 'max' : 'years'; this.updateInternationalChartForPeriod('treasury', periodValue, periodUnit);
                this.markCardAsLoaded('treasuries');
            },

            init() { this.setupEventListeners(); this.setupTheme(); this.applyCardOrder(); this.fetchAllNationalIndicators(); },
            applyCardOrder() { const apply = (storageKey, containerId) => { const savedOrder = localStorage.getItem(storageKey); if (savedOrder) { try { const order = JSON.parse(savedOrder); const container = document.getElementById(containerId); order.forEach(cardId => { const cardElement = container.querySelector(`[data-id="${cardId}"]`); if (cardElement) container.appendChild(cardElement); }); } catch (e) { localStorage.removeItem(storageKey); } } }; apply('cardOrder', 'national-indicators-container'); apply('internationalCardOrder', 'international-indicators-container'); },
            setupTheme() { const savedTheme = localStorage.getItem('themePreference'); const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches; const themeToggleIcon = document.querySelector('#theme-toggle i'); if (savedTheme === 'light' || (savedTheme !== 'dark' && !prefersDark)) { document.body.classList.add('light-mode'); themeToggleIcon.className = 'fas fa-sun'; } else { themeToggleIcon.className = 'fas fa-moon'; } },
            
            setupEventListeners() {
                document.getElementById('back-btn').addEventListener('click', () => window.location.href = 'index.html');
                
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    const btn = document.getElementById('refresh-btn');
                    if (btn.classList.contains('is-refreshing')) return;
                    btn.classList.add('is-refreshing');
                    
                    document.querySelectorAll('.indicator-card').forEach(c => c.classList.remove('card-loaded'));
                    
                    const refreshPromise = this.isInternationalView 
                        ? (localStorage.removeItem('allInternationalIndicators_v6_treasury'), this.fetchAllInternationalIndicators())
                        : (localStorage.removeItem('allNationalIndicators'), this.fetchAllNationalIndicators());

                    refreshPromise.finally(() => {
                        btn.classList.remove('is-refreshing');
                        uiController.showToast('Indicadores atualizados!');
                    });
                });
                
                const toggleFullscreen = () => { if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(err => console.error(err.message)); else if (document.exitFullscreen) document.exitFullscreen(); };
                document.getElementById('fullscreen-btn').addEventListener('click', toggleFullscreen);
                document.getElementById('fullscreen-exit-btn').addEventListener('click', toggleFullscreen);
                const handleFullscreenChange = () => { const isFullscreen = !!document.fullscreenElement; document.getElementById('fullscreen-btn').style.display = isFullscreen ? 'none' : 'flex'; document.getElementById('fullscreen-exit-btn').style.display = isFullscreen ? 'flex' : 'none'; };
                ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'].forEach(event => document.addEventListener(event, handleFullscreenChange, false));
                handleFullscreenChange();
                
                document.getElementById('theme-toggle').addEventListener('click', () => { document.body.classList.toggle('light-mode'); const isLight = document.body.classList.contains('light-mode'); localStorage.setItem('themePreference', isLight ? 'light' : 'dark'); document.querySelector('#theme-toggle i').className = isLight ? 'fas fa-sun' : 'fas fa-moon'; if(this.isInternationalView) { this.processInternationalResults(); } else { this.processNationalResults(this.nationalData); } });
                document.getElementById('view-toggle-switch').addEventListener('change', (e) => { this.isInternationalView = e.target.checked; const nationalContainer = document.getElementById('national-indicators-container'); const internationalContainer = document.getElementById('international-indicators-container'); document.getElementById('label-nacional').classList.toggle('active', !this.isInternationalView); document.getElementById('label-internacional').classList.toggle('active', this.isInternationalView); if (this.isInternationalView) { nationalContainer.style.display = 'none'; internationalContainer.style.display = 'flex'; if (!this.internationalData.series || Object.keys(this.internationalData.series).length === 0) { this.fetchAllInternationalIndicators(); } else { uiController.updateDateTime('FRED St. Louis Fed'); } } else { nationalContainer.style.display = 'flex'; internationalContainer.style.display = 'none'; uiController.updateDateTime('BCB, Investing.com'); } });

                const setupContainerInteractions = (container, containerType) => {
                    container.addEventListener('click', e => {
                        const card = e.target.closest('.indicator-card');
                        if (!card) return;

                        // Botão de período
                        const periodBtn = e.target.closest('.chart-period-btn');
                        if (periodBtn) {
                            const controls = periodBtn.parentElement;
                            const indicatorId = controls.dataset.indicatorId;
                            controls.querySelectorAll('.chart-period-btn').forEach(btn => btn.classList.remove('active'));
                            periodBtn.classList.add('active');

                            if (containerType === 'national') {
                                const period = periodBtn.dataset.days || periodBtn.dataset.months || periodBtn.dataset.years;
                                const periodValue = period === 'max' ? 50 : parseInt(period, 10);
                                this.updateNationalChartForPeriod(indicatorId, periodValue);
                            } else {
                                const periodValue = periodBtn.dataset.years === 'max' ? 'max' : parseInt(periodBtn.dataset.years, 10);
                                const periodUnit = periodBtn.dataset.years === 'max' ? 'max' : 'years';
                                this.updateInternationalChartForPeriod(indicatorId, periodValue, periodUnit);
                            }
                            return;
                        }

                        // Outros controles que não devem virar o card
                        if (e.target.closest('.yield-controls') || e.target.closest('.drag-handle') || e.target.closest('select') || e.target.closest('.card-switch-container')) {
                            return;
                        }

                        // Vira o card
                        card.classList.toggle('flipped');
                    });

                    // Acessibilidade por teclado para virar
                    container.addEventListener('keydown', e => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            const card = e.target.closest('.indicator-card');
                            if (card && document.activeElement === card) {
                                e.preventDefault();
                                card.classList.toggle('flipped');
                            }
                        }
                    });
                };
                
                setupContainerInteractions(document.getElementById('national-indicators-container'), 'national');
                setupContainerInteractions(document.getElementById('international-indicators-container'), 'international');

                document.getElementById('fedtarget-toggle-switch').addEventListener('change', () => this.updateFedTargetView());
                document.getElementById('cpi-toggle-switch').addEventListener('change', () => this.updateCpiCardView('cpi'));
                document.getElementById('core-cpi-toggle-switch').addEventListener('change', () => this.updateCpiCardView('coreCpi'));
                document.getElementById('pce-toggle-switch').addEventListener('change', () => this.updateCpiCardView('pce'));
                document.getElementById('core-pce-toggle-switch').addEventListener('change', () => this.updateCpiCardView('corePce'));

                const setupSortable = (containerId, storageKey) => { new Sortable(document.getElementById(containerId), { animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', handle: '.drag-handle', onEnd: function (evt) { const order = Array.from(evt.to.children).map(el => el.dataset.id); localStorage.setItem(storageKey, JSON.stringify(order)); } }); }
                setupSortable('national-indicators-container', 'cardOrder');
                setupSortable('international-indicators-container', 'internationalCardOrder');
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
